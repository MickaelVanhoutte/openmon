# Playwright E2E Full Coverage

## TL;DR

> **Quick Summary**: Set up Playwright E2E testing from scratch for a Pokemon web game (Svelte 5/Vite), covering all 50 game components with mock save fixtures, automated test runs, and GitHub Actions CI.
>
> **Deliverables**:
>
> - Playwright installation + configuration
> - Test fixtures (mock save files for different game states)
> - E2E tests for all 50 game components (breadth-first)
> - GitHub Actions workflow for automated testing
>
> **Estimated Effort**: Large (40+ tasks)
> **Parallel Execution**: YES - 4 waves
> **Critical Path**: Infrastructure → Fixtures → Critical Path Tests → Breadth Coverage → CI

---

## Context

### Original Request

User experienced regressions from a recent redesign and wants full Playwright E2E coverage to catch future UI regressions.

### Interview Summary

**Key Discussions**:

- Playwright only (not fixing existing TS errors - separate task)
- Full coverage breadth-first (light tests for all 50 components)
- Mock save files for test state setup
- Functional tests only (no visual regression)
- All browsers: Chromium, Firefox, WebKit
- GitHub Actions CI integration

### Metis Review

**Identified Gaps** (addressed):

- Admin page is content editor, NOT test shortcut → Exclude from scope (6 components out)
- Only 9 `data-testid` attributes exist (all in admin/) → Need to add to all 50 game components
- State-based routing (no URL shortcuts) → Need localStorage injection helpers
- Animation timing can cause flaky tests → Use state waits, not timeouts
- DEBUG=true only skips intro → Need test-specific env flag

---

## Work Objectives

### Core Objective

Establish comprehensive E2E test coverage to prevent regressions, with breadth-first approach covering all 50 game components.

### Concrete Deliverables

- `playwright.config.ts` - Configured for Svelte/Vite with 3 browsers
- `e2e/fixtures/*.json` - 5 mock save states covering game phases
- `e2e/helpers/*.ts` - Test utilities (localStorage injection, state setup)
- `e2e/**/*.spec.ts` - E2E tests for all 50 game components
- `.github/workflows/e2e.yml` - CI workflow with caching

### Definition of Done

- [ ] `npm run test:e2e` runs all tests successfully
- [ ] Tests pass on Chromium, Firefox, and WebKit
- [ ] GitHub Actions runs E2E tests on PR
- [ ] No flaky tests (3 consecutive green runs)

### Must Have

- Playwright configured for Vite dev server
- Test fixtures for: fresh game, world exploration, battle-ready, full team, menu testing
- data-testid attributes on all interactive elements
- GitHub Actions with browser caching

### Must NOT Have (Guardrails)

- NO tests for admin page components (src/lib/admin/\*) - content editor, not game
- NO visual regression testing (explicitly out of scope)
- NO hardcoded timeouts (use waitForSelector/state changes)
- NO modification of src/js/env.ts DEBUG flag for test control
- NO animation frame-by-frame testing
- NO audio playback verification (mock Howler.js)
- NO performance benchmarks

---

## Verification Strategy (MANDATORY)

### Test Decision

- **Infrastructure exists**: NO (Playwright not installed)
- **User wants tests**: YES - E2E tests ARE the deliverable
- **Framework**: Playwright

### Verification Approach

Each TODO includes executable Playwright assertions:

```typescript
await expect(page.getByTestId('element')).toBeVisible();
await expect(page.getByTestId('hp-bar')).toHaveAttribute('data-value', /\d+/);
```

**Evidence Requirements:**

- Test output from `npx playwright test`
- HTML report generated by Playwright
- Trace files on failure (for debugging)

---

## Execution Strategy

### Parallel Execution Waves

```
Wave 1 (Infrastructure - Start Immediately):
├── Task 1: Install Playwright + configure
├── Task 2: Create test helper utilities
└── Task 3: Create test fixtures (mock saves)

Wave 2 (Data-TestID Instrumentation - After Wave 1):
├── Task 4: Add data-testid to Battle components
├── Task 5: Add data-testid to World components
├── Task 6: Add data-testid to Menu components
└── Task 7: Add data-testid to Common components

Wave 3 (Critical Path Tests - After Wave 2):
├── Task 8: Intro + Game Start tests
├── Task 9: Player Creation tests
├── Task 10: World navigation tests
├── Task 11: Battle flow tests
├── Task 12: Save/Load tests
└── Task 13: Menu navigation tests

Wave 4 (Breadth Coverage - After Wave 3):
├── Tasks 14-25: Battle component tests (deep)
├── Tasks 26-32: World component tests
├── Tasks 33-45: Menu component tests (light)
└── Tasks 46-50: Common component tests

Wave 5 (CI Integration - After Wave 4):
├── Task 51: GitHub Actions workflow
└── Task 52: PR comment integration
```

### Dependency Matrix

| Task  | Depends On | Blocks | Can Parallelize With |
| ----- | ---------- | ------ | -------------------- |
| 1-3   | None       | 4-7    | Each other (Wave 1)  |
| 4-7   | 1-3        | 8-13   | Each other (Wave 2)  |
| 8-13  | 4-7        | 14-50  | Each other (Wave 3)  |
| 14-50 | 8-13       | 51-52  | Each other (Wave 4)  |
| 51-52 | 14-50      | None   | Each other (Wave 5)  |

---

## TODOs

### Wave 1: Infrastructure Setup

- [x] 1. Install Playwright and Configure for Svelte/Vite

  **What to do**:
  - Run `npm init playwright@latest`
  - Configure `playwright.config.ts` for Vite dev server (baseURL: http://localhost:5173)
  - Set up 3 browser projects: chromium, firefox, webkit
  - Configure retries, timeout, and reporter settings
  - Add test scripts to package.json: `test:e2e`, `test:e2e:ui`, `test:e2e:headed`

  **Must NOT do**:
  - Don't modify existing vitest configuration
  - Don't add visual comparison tools

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Standard library installation with minimal customization
  - **Skills**: [`playwright`]
    - `playwright`: Direct overlap with Playwright MCP knowledge

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 1 (with Tasks 2, 3)
  - **Blocks**: Tasks 4-7 (data-testid instrumentation)
  - **Blocked By**: None

  **References**:
  - `package.json` - Add new dev dependencies and scripts
  - `vite.config.ts` - Understand existing Vite configuration for baseURL
  - Official: https://playwright.dev/docs/intro - Installation guide
  - Official: https://playwright.dev/docs/test-webserver - Vite integration

  **Acceptance Criteria**:

  ```bash
  # Verify Playwright installed
  npx playwright --version
  # Expected: Version X.X.X

  # Verify config exists
  ls playwright.config.ts
  # Expected: file exists

  # Verify browsers installed
  npx playwright install --dry-run
  # Expected: Shows chromium, firefox, webkit

  # Verify test script exists
  npm run test:e2e -- --help
  # Expected: Shows Playwright help
  ```

  **Commit**: YES
  - Message: `feat(test): add Playwright E2E testing infrastructure`
  - Files: `package.json`, `playwright.config.ts`, `package-lock.json`
  - Pre-commit: `npx playwright --version`

---

- [x] 2. Create Test Helper Utilities

  **What to do**:
  - Create `e2e/helpers/save-state.ts` with `injectSaveState(page, fixture)` function
  - Create `e2e/helpers/game-state.ts` with functions to:
    - `waitForGameReady(page)` - Wait for game to be interactive
    - `startNewGame(page, playerName)` - Complete character creation
    - `navigateToBattle(page)` - Set up battle state
  - Create `e2e/helpers/index.ts` to export all helpers
  - Use `page.evaluate()` for localStorage injection
  - Use `page.addInitScript()` for consistent setup

  **Must NOT do**:
  - Don't use hardcoded timeouts
  - Don't modify source code (only create new test files)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Creating utility functions with clear patterns
  - **Skills**: [`playwright`]
    - `playwright`: Playwright-specific APIs (page.evaluate, addInitScript)

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 1 (with Tasks 1, 3)
  - **Blocks**: Tasks 4-7 (data-testid instrumentation)
  - **Blocked By**: None

  **References**:
  - `src/js/context/savesHolder.ts` - SaveContext structure for fixture format
  - `src/App.svelte:45-60` - State-based routing logic to understand game states
  - `src/lib/saves/LoadSave.svelte` - How saves are loaded from localStorage
  - Official: https://playwright.dev/docs/evaluating - page.evaluate() usage

  **Acceptance Criteria**:

  ```bash
  # Verify helper files exist
  ls e2e/helpers/*.ts
  # Expected: save-state.ts, game-state.ts, index.ts

  # Verify TypeScript compiles
  npx tsc --noEmit e2e/helpers/*.ts
  # Expected: No errors (or configure tsconfig for e2e)
  ```

  **Commit**: YES
  - Message: `feat(test): add E2E test helper utilities for save state injection`
  - Files: `e2e/helpers/*.ts`
  - Pre-commit: `ls e2e/helpers/`

---

- [x] 3. Create Test Fixtures (Mock Save Files)

  **What to do**:
  - Create `e2e/fixtures/` directory
  - Create 5 fixture files matching SaveContext structure:
    - `fresh-game.json` - Just after character creation, starter Pokemon
    - `world-exploration.json` - Player in overworld, can move around
    - `battle-ready.json` - Standing in front of trainer, battle can trigger
    - `full-team.json` - 6 Pokemon with various HP/status states
    - `menu-testing.json` - Items in bag, Pokemon with moves, Pokedex entries
  - Each fixture should have realistic data matching existing JSON structures

  **Must NOT do**:
  - Don't create saves that trigger mid-battle state (battles not saveable)
  - Don't include corrupted or invalid JSON

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: JSON file creation based on existing structure
  - **Skills**: []
    - No specialized skills needed - JSON file creation

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 1 (with Tasks 1, 2)
  - **Blocks**: Tasks 4-7 (data-testid instrumentation)
  - **Blocked By**: None

  **References**:
  - `src/js/context/savesHolder.ts` - SaveContext interface definition
  - `src/js/context/gameContext.ts` - GameContext structure
  - `src/assets/data/final/beta/pokedex-animatedV3.json` - Valid Pokemon IDs
  - `src/assets/data/final/beta/items.json` - Valid item IDs
  - `src/assets/data/maps/` - Valid map references

  **Acceptance Criteria**:

  ```bash
  # Verify fixture files exist
  ls e2e/fixtures/*.json
  # Expected: 5 JSON files

  # Verify JSON is valid
  for f in e2e/fixtures/*.json; do node -e "require('$f')"; done
  # Expected: No parse errors

  # Verify structure matches SaveContext (spot check)
  node -e "const s = require('./e2e/fixtures/fresh-game.json'); console.log(!!s.player && !!s.pokemons)"
  # Expected: true
  ```

  **Commit**: YES
  - Message: `feat(test): add E2E test fixtures for different game states`
  - Files: `e2e/fixtures/*.json`
  - Pre-commit: `ls e2e/fixtures/`

---

### Wave 2: Data-TestID Instrumentation

- [x] 4. Add data-testid to Battle Components

  **What to do**:
  - Add `data-testid` attributes to all interactive elements in:
    - `src/lib/battle/Battle.svelte` - battle-screen, ally-sprite, opponent-sprite
    - `src/lib/battle/ActionBar.svelte` - action-fight, action-bag, action-switch, action-run
    - `src/lib/battle/FloatingPokemonInfo.svelte` - ally-hp, opponent-hp, ally-status, opponent-status
    - `src/lib/battle/SplitMoveSelector.svelte` - move-0, move-1, move-2, move-3
    - `src/lib/battle/TargetSelector.svelte` - target-0, target-1, etc.
    - `src/lib/battle/SplitActionButtons.svelte` - action-buttons
    - `src/lib/battle/BattleHud.svelte` - battle-hud
  - Use pattern: `data-testid="[component]-[element]"`

  **Must NOT do**:
  - Don't add testids to purely decorative elements
  - Don't change component logic

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Adding attributes to existing elements, repetitive task
  - **Skills**: []
    - No specialized skills - HTML attribute addition

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 5, 6, 7)
  - **Blocks**: Tasks 8-13 (critical path tests)
  - **Blocked By**: Tasks 1-3 (Wave 1 infrastructure)

  **References**:
  - `src/lib/battle/*.svelte` - All battle component files
  - `src/lib/battle/ActionBar.svelte:350-400` - Button elements for Fight/Bag/Switch/Run
  - `src/lib/battle/FloatingPokemonInfo.svelte:100-150` - HP bar elements

  **Acceptance Criteria**:

  ```bash
  # Verify testids added (grep count)
  grep -r "data-testid" src/lib/battle/*.svelte | wc -l
  # Expected: >= 15 occurrences

  # Verify key testids exist
  grep -q 'data-testid="action-fight"' src/lib/battle/ActionBar.svelte && echo "OK"
  # Expected: OK

  grep -q 'data-testid="battle-screen"' src/lib/battle/Battle.svelte && echo "OK"
  # Expected: OK
  ```

  **Commit**: YES (groups with 5, 6, 7)
  - Message: `feat(test): add data-testid attributes for E2E testing`
  - Files: `src/lib/battle/*.svelte`
  - Pre-commit: `npm run check`

---

- [x] 5. Add data-testid to World Components

  **What to do**:
  - Add `data-testid` attributes to:
    - `src/lib/world/World.svelte` - world-screen, player-sprite
    - `src/lib/world/Controls.svelte` - control-up, control-down, control-left, control-right
    - `src/lib/world/OverworldTeamPanel.svelte` - team-panel, team-pokemon-0 through team-pokemon-5
    - `src/lib/world/Interactible.svelte` - interactible-npc (with dynamic ID)

  **Must NOT do**:
  - Don't add testids to map tiles (too many)
  - Don't change component logic

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Adding attributes to existing elements
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 4, 6, 7)
  - **Blocks**: Tasks 8-13
  - **Blocked By**: Tasks 1-3

  **References**:
  - `src/lib/world/*.svelte` - All world component files

  **Acceptance Criteria**:

  ```bash
  grep -r "data-testid" src/lib/world/*.svelte | wc -l
  # Expected: >= 8 occurrences
  ```

  **Commit**: YES (groups with 4, 6, 7)
  - Message: `feat(test): add data-testid attributes for E2E testing`
  - Files: `src/lib/world/*.svelte`
  - Pre-commit: `npm run check`

---

- [ ] 6. Add data-testid to Menu Components (PARTIAL)

  **What to do**:
  - Add `data-testid` attributes to all menu components:
    - `src/lib/menus/pokemon-list/*.svelte` - pokemon-list, pokemon-item-0 through pokemon-item-5
    - `src/lib/menus/pokedex/*.svelte` - pokedex-screen, pokedex-entry
    - `src/lib/menus/bag/Bag.svelte` - bag-screen, bag-item
    - `src/lib/menus/boxes/*.svelte` - boxes-screen, box-slot
    - `src/lib/menus/trainer/*.svelte` - trainer-screen, trainer-info

  **Must NOT do**:
  - Don't add testids to every list item (use index-based pattern)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Repetitive attribute addition
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 4, 5, 7)
  - **Blocks**: Tasks 8-13
  - **Blocked By**: Tasks 1-3

  **References**:
  - `src/lib/menus/**/*.svelte` - All menu component files

  **Acceptance Criteria**:

  ```bash
  grep -r "data-testid" src/lib/menus/**/*.svelte | wc -l
  # Expected: >= 20 occurrences
  ```

  **Commit**: YES (groups with 4, 5, 7)
  - Message: `feat(test): add data-testid attributes for E2E testing`
  - Files: `src/lib/menus/**/*.svelte`
  - Pre-commit: `npm run check`

---

- [x] 7. Add data-testid to Common Components

  **What to do**:
  - Add `data-testid` attributes to:
    - `src/lib/common/Modal.svelte` - modal-overlay, modal-content, modal-close
    - `src/lib/common/DialogView.svelte` - dialog-box, dialog-text, dialog-continue
    - `src/lib/saves/LoadSave.svelte` - load-save-screen, save-slot-0 through save-slot-2
    - `src/lib/saves/PlayerCreation.svelte` - player-creation, name-input, confirm-button
    - `src/lib/Intro.svelte` - intro-screen, start-button

  **Must NOT do**:
  - Don't modify admin components

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Straightforward attribute addition
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 4, 5, 6)
  - **Blocks**: Tasks 8-13
  - **Blocked By**: Tasks 1-3

  **References**:
  - `src/lib/common/*.svelte` - Common components
  - `src/lib/saves/*.svelte` - Save/load components
  - `src/lib/Intro.svelte` - Intro screen

  **Acceptance Criteria**:

  ```bash
  grep -r "data-testid" src/lib/common/*.svelte src/lib/saves/*.svelte src/lib/Intro.svelte | wc -l
  # Expected: >= 12 occurrences
  ```

  **Commit**: YES (groups with 4, 5, 6)
  - Message: `feat(test): add data-testid attributes for E2E testing`
  - Files: `src/lib/common/*.svelte`, `src/lib/saves/*.svelte`, `src/lib/Intro.svelte`
  - Pre-commit: `npm run check`

---

### Wave 3: Critical Path Tests

- [x] 8. Write Intro and Game Start Tests

  **What to do**:
  - Create `e2e/intro.spec.ts` with tests:
    - `test('intro screen displays on first visit')`
    - `test('clicking start begins game')`
    - `test('intro is skipped when save exists')`
  - Use fixtures to test different scenarios

  **Must NOT do**:
  - Don't test intro animations (just state transitions)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: First E2E test, establishes patterns
  - **Skills**: [`playwright`]
    - `playwright`: Playwright test syntax and assertions

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 9-13)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/Intro.svelte` - Intro component structure
  - `src/App.svelte:45-60` - started state logic
  - `e2e/helpers/save-state.ts` - Fixture injection

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/intro.spec.ts
  # Expected: 3 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add intro and game start tests`
  - Files: `e2e/intro.spec.ts`
  - Pre-commit: `npx playwright test e2e/intro.spec.ts`

---

- [x] 9. Write Player Creation Tests

  **What to do**:
  - Create `e2e/player-creation.spec.ts` with tests:
    - `test('player creation screen shows for new game')`
    - `test('can enter player name')`
    - `test('can select starter Pokemon')`
    - `test('confirming creation starts game')`

  **Must NOT do**:
  - Don't test every validation edge case (just happy path)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Form interaction testing, clear scope
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 8, 10-13)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/saves/PlayerCreation.svelte` - Creation form
  - `e2e/fixtures/` - Empty save state

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/player-creation.spec.ts
  # Expected: 4 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add player creation flow tests`
  - Files: `e2e/player-creation.spec.ts`
  - Pre-commit: `npx playwright test e2e/player-creation.spec.ts`

---

- [x] 10. Write World Navigation Tests

  **What to do**:
  - Create `e2e/world.spec.ts` with tests:
    - `test('world screen renders with player sprite')`
    - `test('arrow keys move player')`
    - `test('touch controls work')`
    - `test('can interact with NPC')`
    - `test('menu opens from overworld')`

  **Must NOT do**:
  - Don't test every map (just one representative map)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Movement and interaction testing
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 8, 9, 11-13)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/world/World.svelte` - World component
  - `src/lib/world/Controls.svelte` - Control handling
  - `e2e/fixtures/world-exploration.json` - World-ready save

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/world.spec.ts
  # Expected: 5 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add world navigation tests`
  - Files: `e2e/world.spec.ts`
  - Pre-commit: `npx playwright test e2e/world.spec.ts`

---

- [x] 11. Write Battle Flow Tests (DEEP COVERAGE)

  **What to do**:
  - Create `e2e/battle.spec.ts` with comprehensive tests:
    - `test('battle screen renders correctly')`
    - `test('can select Fight action')`
    - `test('move selector shows 4 moves')`
    - `test('selecting move executes attack')`
    - `test('HP bar updates after damage')`
    - `test('can switch Pokemon')`
    - `test('can use item from bag')`
    - `test('can attempt to run')`
    - `test('fainted Pokemon triggers switch prompt')`
    - `test('battle ends when opponent team faints')`
  - Use `battle-ready.json` and `full-team.json` fixtures

  **Must NOT do**:
  - Don't verify animation frames (wait for state changes)
  - Don't test every move (test one representative move)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
    - Reason: Complex state machine with many interactions, highest regression area
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 8-10, 12-13)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/battle/Battle.svelte` - Main battle component
  - `src/lib/battle/ActionBar.svelte:350-500` - Action button handlers
  - `src/lib/battle/FloatingPokemonInfo.svelte` - HP display
  - `e2e/fixtures/battle-ready.json` - Battle-triggerable save
  - `e2e/fixtures/full-team.json` - Full team for switch testing

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/battle.spec.ts
  # Expected: 10 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add comprehensive battle flow tests`
  - Files: `e2e/battle.spec.ts`
  - Pre-commit: `npx playwright test e2e/battle.spec.ts`

---

- [x] 12. Write Save/Load Tests

  **What to do**:
  - Create `e2e/save-load.spec.ts` with tests:
    - `test('load save screen shows existing saves')`
    - `test('can select and load a save')`
    - `test('loaded save restores player name')`
    - `test('loaded save restores Pokemon team')`
    - `test('can create new save from load screen')`

  **Must NOT do**:
  - Don't test save file corruption (edge case)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: State restoration testing
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 8-11, 13)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/saves/LoadSave.svelte` - Load save screen
  - `src/js/context/savesHolder.ts` - Save structure
  - `e2e/fixtures/*.json` - All fixtures

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/save-load.spec.ts
  # Expected: 5 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add save/load flow tests`
  - Files: `e2e/save-load.spec.ts`
  - Pre-commit: `npx playwright test e2e/save-load.spec.ts`

---

- [x] 13. Write Menu Navigation Tests

  **What to do**:
  - Create `e2e/menus.spec.ts` with tests:
    - `test('can open Pokemon list from overworld')`
    - `test('can view Pokemon summary')`
    - `test('can open bag')`
    - `test('can open Pokedex')`
    - `test('can close menus with escape')`
    - `test('keyboard navigation works in menus')`

  **Must NOT do**:
  - Don't test every menu interaction (just opening/closing)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Navigation pattern testing
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 3 (with Tasks 8-12)
  - **Blocks**: Tasks 14-50
  - **Blocked By**: Tasks 4-7

  **References**:
  - `src/lib/menus/**/*.svelte` - All menu components
  - `e2e/fixtures/menu-testing.json` - Menu-ready save

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/menus.spec.ts
  # Expected: 6 tests passed
  ```

  **Commit**: YES
  - Message: `test(e2e): add menu navigation tests`
  - Files: `e2e/menus.spec.ts`
  - Pre-commit: `npx playwright test e2e/menus.spec.ts`

---

### Wave 4: Breadth Coverage (Grouped by Component Area)

- [ ] 14-20. Battle Component Deep Tests

  **What to do**:
  - Create individual test files for each battle component:
    - `e2e/battle/action-bar.spec.ts` - All action bar interactions
    - `e2e/battle/move-selector.spec.ts` - Move selection details
    - `e2e/battle/target-selector.spec.ts` - Target selection for multi-target moves
    - `e2e/battle/floating-info.spec.ts` - HP bar, status, stat changes display
    - `e2e/battle/battle-hud.spec.ts` - HUD elements
    - `e2e/battle/switch-pokemon.spec.ts` - Pokemon switching flow
    - `e2e/battle/battle-bag.spec.ts` - Using items in battle

  **Must NOT do**:
  - Don't duplicate tests from Task 11

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: Component-specific tests following established patterns
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES (all 7 tasks in parallel)
  - **Parallel Group**: Wave 4a
  - **Blocks**: Tasks 51-52
  - **Blocked By**: Tasks 8-13

  **References**:
  - `src/lib/battle/*.svelte` - All battle components
  - `e2e/battle.spec.ts` - Pattern from Task 11

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/battle/
  # Expected: All tests pass
  ```

  **Commit**: YES (group all battle component tests)
  - Message: `test(e2e): add comprehensive battle component tests`
  - Files: `e2e/battle/*.spec.ts`

---

- [ ] 21-27. World and Menu Component Tests

  **What to do**:
  - Create test files for remaining world/menu components:
    - `e2e/world/controls.spec.ts` - Touch and keyboard controls
    - `e2e/world/team-panel.spec.ts` - Overworld team display
    - `e2e/menus/pokemon-list.spec.ts` - Pokemon list interactions
    - `e2e/menus/pokemon-summary.spec.ts` - Summary screen details
    - `e2e/menus/bag.spec.ts` - Bag item management
    - `e2e/menus/pokedex.spec.ts` - Pokedex browsing
    - `e2e/menus/boxes.spec.ts` - PC box management

  **Must NOT do**:
  - Don't test internal logic (E2E only)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: Following established patterns
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES (all 7 tasks in parallel)
  - **Parallel Group**: Wave 4b
  - **Blocks**: Tasks 51-52
  - **Blocked By**: Tasks 8-13

  **References**:
  - `src/lib/world/*.svelte` - World components
  - `src/lib/menus/**/*.svelte` - Menu components

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/world/ e2e/menus/
  # Expected: All tests pass
  ```

  **Commit**: YES (group by area)
  - Message: `test(e2e): add world and menu component tests`
  - Files: `e2e/world/*.spec.ts`, `e2e/menus/*.spec.ts`

---

- [ ] 28-32. Common Component and Edge Case Tests

  **What to do**:
  - Create test files for common components and edge cases:
    - `e2e/common/modal.spec.ts` - Modal open/close behavior
    - `e2e/common/dialog.spec.ts` - Dialog text and progression
    - `e2e/edge-cases/no-save.spec.ts` - First-time user flow
    - `e2e/edge-cases/orientation.spec.ts` - Orientation lock on mobile
    - `e2e/edge-cases/keyboard-nav.spec.ts` - Full keyboard navigation

  **Must NOT do**:
  - Don't test corrupted save handling (out of scope)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: Edge case testing
  - **Skills**: [`playwright`]

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 4c
  - **Blocks**: Tasks 51-52
  - **Blocked By**: Tasks 8-13

  **References**:
  - `src/lib/common/*.svelte` - Common components
  - `src/App.svelte:100-120` - Orientation check logic

  **Acceptance Criteria**:

  ```bash
  npx playwright test e2e/common/ e2e/edge-cases/
  # Expected: All tests pass
  ```

  **Commit**: YES
  - Message: `test(e2e): add common component and edge case tests`
  - Files: `e2e/common/*.spec.ts`, `e2e/edge-cases/*.spec.ts`

---

### Wave 5: CI Integration

- [x] 33. Create GitHub Actions E2E Workflow

  **What to do**:
  - Create `.github/workflows/e2e.yml` with:
    - Trigger on pull_request and push to master
    - Node.js 20.x setup
    - Cache node_modules AND Playwright browsers
    - Run chromium only on PR (fast feedback)
    - Run all 3 browsers on push to master (full verification)
    - Upload trace files on failure
    - Upload HTML report as artifact

  **Must NOT do**:
  - Don't block deployment on E2E failures (initially)
  - Don't run on every commit (only PR and merge)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: YAML configuration
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 5 (with Task 34)
  - **Blocks**: None (final task)
  - **Blocked By**: Tasks 14-32

  **References**:
  - `.github/workflows/static.yml` - Existing workflow pattern
  - Official: https://playwright.dev/docs/ci-intro#github-actions - CI setup

  **Acceptance Criteria**:

  ```bash
  # Verify workflow file exists and is valid YAML
  cat .github/workflows/e2e.yml | head -20
  # Expected: Valid YAML with 'on:', 'jobs:', etc.

  # Validate with act (if installed) or push to branch
  # Expected: Workflow triggers on PR
  ```

  **Commit**: YES
  - Message: `ci: add GitHub Actions E2E testing workflow`
  - Files: `.github/workflows/e2e.yml`
  - Pre-commit: `cat .github/workflows/e2e.yml`

---

- [x] 34. Add Test Summary and Documentation

  **What to do**:
  - Update `README.md` with E2E testing section
  - Create `e2e/README.md` with:
    - How to run tests locally
    - How to add new tests
    - Fixture documentation
    - Troubleshooting guide

  **Must NOT do**:
  - Don't over-document (keep it concise)

  **Recommended Agent Profile**:
  - **Category**: `writing`
    - Reason: Documentation task
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 5 (with Task 33)
  - **Blocks**: None (final task)
  - **Blocked By**: Tasks 14-32

  **References**:
  - `README.md` - Existing documentation
  - `e2e/` - All test files created

  **Acceptance Criteria**:

  ```bash
  # Verify README updated
  grep -q "E2E Testing" README.md && echo "OK"
  # Expected: OK

  # Verify e2e README exists
  ls e2e/README.md
  # Expected: file exists
  ```

  **Commit**: YES
  - Message: `docs: add E2E testing documentation`
  - Files: `README.md`, `e2e/README.md`
  - Pre-commit: `ls e2e/README.md`

---

## Commit Strategy

| After Task(s) | Message                                                  | Files                              |
| ------------- | -------------------------------------------------------- | ---------------------------------- |
| 1             | `feat(test): add Playwright E2E testing infrastructure`  | package.json, playwright.config.ts |
| 2             | `feat(test): add E2E test helper utilities`              | e2e/helpers/\*.ts                  |
| 3             | `feat(test): add E2E test fixtures`                      | e2e/fixtures/\*.json               |
| 4-7           | `feat(test): add data-testid attributes for E2E testing` | src/lib/\*_/_.svelte               |
| 8-13          | `test(e2e): add critical path tests`                     | e2e/\*.spec.ts                     |
| 14-32         | `test(e2e): add comprehensive component tests`           | e2e/\*_/_.spec.ts                  |
| 33            | `ci: add GitHub Actions E2E workflow`                    | .github/workflows/e2e.yml          |
| 34            | `docs: add E2E testing documentation`                    | README.md, e2e/README.md           |

---

## Success Criteria

### Verification Commands

```bash
# Run all E2E tests
npm run test:e2e
# Expected: All tests pass (0 failures)

# Run with all browsers
npx playwright test --project=chromium --project=firefox --project=webkit
# Expected: All pass on all 3 browsers

# Generate coverage report
npx playwright test --reporter=html
# Expected: HTML report generated

# Verify no flaky tests (run 3 times)
for i in 1 2 3; do npm run test:e2e; done
# Expected: All 3 runs pass
```

### Final Checklist

- [ ] Playwright installed and configured
- [ ] 5 test fixtures covering all game phases
- [ ] data-testid on all 50 game components
- [ ] Critical path tests: Intro, Creation, World, Battle, Save/Load, Menus
- [ ] Component-level tests for battle, world, menus, common
- [ ] GitHub Actions workflow running on PR
- [ ] Documentation updated
- [ ] No flaky tests (3 consecutive green runs)
