import{p as ve,a as ge,b as be,o as me,g as e,s as d,l as C,d as qe,c as ye,i as he,e as E,f as te,h as re,M as we,t as B,j as H,u as F,k as I,m as Oe,n as P,q as xe,r as m,v as _e,w as R}from"./main-BXvrheyS.js";import{S as se,n as oe,q as ie,a as ae,b as v}from"./mastery-DJiwniJv.js";import{g as Me}from"./vendor-Woj35R5a.js";/* empty css            */import"./chartjs-CIVOkaCU.js";var $e=R('<p style="margin: 0"> </p> <hr/> <p style="margin: 0"> </p> <hr/> <button class="button primary">Activate</button>',1),Se=R('<h3 slot="header" style="margin: 2% 0"> </h3>'),Ee=R('<div class="offset svelte-ub7mba"></div> <div class="masteries svelte-ub7mba"></div> <div class="expert svelte-ub7mba"></div> <span class="points svelte-ub7mba"> </span> <!>',1);const Te={hash:"svelte-ub7mba",code:".offset.svelte-ub7mba {width:100%;}.masteries.svelte-ub7mba {width:100dvw;height:10dvw;margin-left:1%;overflow:visible;}.masteries svg {overflow:visible;z-index:-1;}.expert.svelte-ub7mba {width:100dvw;height:calc(85dvh - 46px);overflow:visible;}.expert svg {overflow:visible;z-index:-1;}.points.svelte-ub7mba {position:absolute;bottom:0;right:0;padding:8px;font-size:32px;color:white;text-shadow:1px 1px 1px black;}.modal {min-width:60%;}"};function Ce(V,X){ve(X,!1),ge(V,Te);const O=m(),k=m(),c=m(),q=m();let T=be(X,"context",12),_=m(),M=m(),N=m(!1),g=m(),Y=m(),i,y=m(),z,w,W,p=m(),G=!1,j=0;function A(t,n,o,l,a=!1){function r(f,u,b){return[u.neighborOf({q:f.q,r:f.r},v.NE,{allowOutside:!1}),u.neighborOf({q:f.q,r:f.r},v.NW,{allowOutside:!1}),u.neighborOf({q:f.q,r:f.r},v.E,{allowOutside:!1}),u.neighborOf({q:f.q,r:f.r},v.W,{allowOutside:!1}),u.neighborOf({q:f.q,r:f.r},v.SE,{allowOutside:!1}),u.neighborOf({q:f.q,r:f.r},v.SW,{allowOutside:!1})].filter(h=>!!h).some(h=>{if(b.find(ee=>ee.q===h.q&&ee.r===h.r)?.set)return!0})}let s=o.find(f=>f.q===t.q&&f.r===t.r),x=Math.min(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),S=Math.max(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),ce=Math.min(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),de=Math.max(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),Z=Math.abs(de-ce),pe=Math.abs(S-x);if(s){let f=r(t,l,o);const u=n.polygon(t.corners.map(({x:b,y:h})=>`${b},${h}`)).fill({color:"white",opacity:.8}).css("cursor","pointer").css("text-align","center").id(`hex-${t.q}-${t.r}`).stroke({width:2,color:"#04548f",opacity:.5});if(j+=s.cost,!s.set&&!f&&!s.first)u.fill({color:"#000",opacity:.5});else if(!s.set&&f&&!s.first)if(a&&!e(c).every(b=>b.set||b.first))u.fill({color:"#000",opacity:.5});else{var ue=n.gradient("linear",function(b){b.stop({offset:.75,color:"#000",opacity:.5}),b.stop({offset:.75,color:"#FFF",opacity:1})}).from(0,0).to(1.2,.8);u.fill(ue),s.settable=!0}else s.first||u.fill({color:s.color,opacity:1});n.group().add(u),s?.title&&s.title.split(" ").forEach((b,h)=>{n.text(b).id(`text-${t.q}-${t.r}-${h}`).move(t.corners[0].x-Z/2,t.corners[0].y-14+h*(pe/4)).css("pointer-events","none").css("text-anchor","middle").css("transform","translate(100)").font({family:"pokemon",fill:s.set?"#444":s.color,size:Z/4,weight:"bold",leading:1})})}}function L(t,n,o,l,a){t&&!t.first&&!G&&(d(g,t),d(Y,n),d(N,!0),i=l,d(y,a))}function $(t,n,o,l=!1,a){t.clear(),n.filter(r=>!a||!(a.q===r.q&&a.r===r.r)).forEach(r=>A(r,t,o,n,l)),a&&A(a,t,o,n,l)}function D(t,n){G=!0;let o=e(c)===n?"initiate":"expert";n===e(c)?$(z,w,e(c),!1,i):$(W,e(p),e(q),!0,i),d(N,!1),T().player.setMastery(t);let l=[e(y).neighborOf({q:i.q,r:i.r},v.NE,{allowOutside:!1}),e(y).neighborOf({q:i.q,r:i.r},v.NW,{allowOutside:!1}),e(y).neighborOf({q:i.q,r:i.r},v.E,{allowOutside:!1}),e(y).neighborOf({q:i.q,r:i.r},v.W,{allowOutside:!1}),e(y).neighborOf({q:i.q,r:i.r},v.SE,{allowOutside:!1}),e(y).neighborOf({q:i.q,r:i.r},v.SW,{allowOutside:!1})].filter(r=>!!r).filter(r=>{let s=n.find(x=>x.q===r.q&&x.r===r.r);return!s?.set&&!s.settable}).map(r=>"#"+o+" #hex-"+r.q+"-"+r.r),a=Me.timeline();console.log(l),a.to("#"+o+" #hex-"+i.q+"-"+i.r,{scale:1.3,duration:1,repeat:1,transformOrigin:"50% 50%",position:"relative",rotate:180,yoyo:!0},"fx").to("#"+o+" #hex-"+i.q+"-"+i.r,{fill:t.color,fillOpacity:1},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-0",{fill:"#444"},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-1",{fill:"#444"},"fx"),l.forEach(r=>{a.to(r,{duration:.5,transformOrigin:"50% 50%",scale:.85},"fx+1").to(r,{duration:.5,transformOrigin:"50% 50%",scale:1},"fx+1.5")}),a.play().then(()=>{if(t.group=="novice"){if(console.log("redraw initiate"),$(z,w,e(c),!1),G=!1,e(c).every(r=>r.set||r.first)){console.log("init expert");let r=e(q).find(s=>s.first);d(y,e(p)),i=e(p).getHex({q:r?.q,r:r?.r}),console.log(r,i),D(r,e(q))}}else console.log("redraw expert"),$(W,e(p),e(q),!0),G=!1})}me(()=>{z=se().addTo(e(_)).size("100%","100%").id("initiate").css("zIndex","-1");const t=oe({dimensions:e(_).getBoundingClientRect().width/28.4,origin:"topLeft"});w=new ie(t,ae({width:16,height:1})),$(z,w,e(c),!1),e(_).addEventListener("click",({target:o,offsetX:l,offsetY:a})=>{const r=w.pointToHex({x:l,y:a},{allowOutside:!1});L(e(c).find(s=>s.q===r.q&&s.r===r.r),e(c),o,r,w)}),e(_).addEventListener("touch",({target:o,offsetX:l,offsetY:a})=>{const r=w.pointToHex({x:l,y:a},{allowOutside:!1});L(e(c).find(s=>s.q===r.q&&s.r===r.r),e(c),o,r,w)}),W=se().addTo(e(M)).id("expert").size("100%","100%");const n=oe({dimensions:e(M).getBoundingClientRect().width/26.5,origin:"topLeft"});d(p,new ie(n,ae({width:15,height:4}))),$(W,e(p),e(q),!0),e(M).addEventListener("click",({target:o,offsetX:l,offsetY:a})=>{console.log(o);const r=e(p).pointToHex({x:l,y:a},{allowOutside:!1});L(e(q).find(s=>s.q===r.q&&s.r===r.r),e(q),o,r,e(p))}),e(M).addEventListener("touch",({target:o,offsetX:l,offsetY:a})=>{const r=e(p).pointToHex({x:l,y:a},{allowOutside:!1});L(e(q).find(s=>s.q===r.q&&s.r===r.r),e(q),o,r,e(p))}),console.log(j)}),C(()=>qe(T()),()=>{d(O,T().player.playerMasteries)}),C(()=>e(O),()=>{d(k,e(O).points)}),C(()=>e(O),()=>{d(c,e(O).novice)}),C(()=>e(O),()=>{d(q,e(O).expert)}),ye();var le={get context(){return T()},set context(t){T(t),_e()}};he();var J=Ee(),K=E(te(J),2);re(K,t=>d(_,t),()=>e(_));var Q=E(K,2);re(Q,t=>d(M,t),()=>e(M));var U=E(Q,2),ne=P(U),fe=E(U,2);return we(fe,{get showModal(){return e(N)},set showModal(t){d(N,t)},children:(t,n)=>{var o=$e(),l=te(o),a=P(l),r=E(l,4),s=P(r),x=E(r,4);B(S=>{H(a,`cost : ${e(g),F(()=>e(g)?.cost)??""}`),H(s,(e(g),F(()=>e(g)?.description))),x.disabled=S},[()=>(e(g),e(k),e(y),e(p),e(c),F(()=>!e(g)?.settable||e(k)<e(g)?.cost||e(y)===e(p)&&!e(c).every(S=>S.set||S.first)))]),Oe("click",x,()=>{D(e(g),e(Y))}),I(t,o)},$$slots:{default:!0,header:(t,n)=>{var o=Se(),l=P(o);B(()=>H(l,(e(g),F(()=>e(g)?.title)))),I(t,o)}},$$legacy:!0}),B(()=>H(ne,`${e(k)??""} points`)),I(V,J),xe(le)}export{Ce as default};
