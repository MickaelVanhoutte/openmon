import{p as ft,o as dt,s as b,i as e,a as _,C as Z,K as tt,t as B,r as G,c as I,b as ut,j as z,f as pt,h as $,y as H,l as R,d as vt}from"./threlte-BXFO_UfO.js";import{S as et,n as rt,q as st,a as ot,b as g}from"./mastery-DJiwniJv.js";import{g as qt}from"./gsap-DDlvirwQ.js";import{M as mt}from"./Modal-D1_OD6HI.js";import"./threejs-vnh2HIri.js";var gt=R('<p style="margin: 0"> </p> <hr/> <p style="margin: 0"> </p> <hr/> <button class="button primary">Activate</button>',1),yt=R('<h3 slot="header" style="margin: 2% 0"> </h3>'),bt=R('<div class="offset svelte-ub7mba"></div> <div class="masteries svelte-ub7mba"></div> <div class="expert svelte-ub7mba"></div> <span class="points svelte-ub7mba"> </span> <!>',1);function Tt(it,F){ft(F,!0);let E,M,k=$(!1),T=$(void 0),V,o,O=$(void 0);const P=H(()=>F.context.player.playerMasteries),X=H(()=>e(P).points),v=H(()=>e(P).novice);let L,x=$(void 0);const w=H(()=>e(P).expert);let N,y=$(void 0),C=$(!1),nt=0;function Y(t,n,i,f,a=!1){function r(l,q,h){return[q.neighborOf({q:l.q,r:l.r},g.NE,{allowOutside:!1}),q.neighborOf({q:l.q,r:l.r},g.NW,{allowOutside:!1}),q.neighborOf({q:l.q,r:l.r},g.E,{allowOutside:!1}),q.neighborOf({q:l.q,r:l.r},g.W,{allowOutside:!1}),q.neighborOf({q:l.q,r:l.r},g.SE,{allowOutside:!1}),q.neighborOf({q:l.q,r:l.r},g.SW,{allowOutside:!1})].filter(m=>!!m).some(m=>{if(h.find(U=>U.q===m.q&&U.r===m.r)?.set)return!0})}const s=i.find(l=>l.q===t.q&&l.r===t.r),d=Math.min(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),u=Math.max(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),c=Math.min(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),p=Math.max(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),Q=Math.abs(p-c),ct=Math.abs(u-d);if(s){const l=r(t,f,i),q=n.polygon(t.corners.map(({x:h,y:m})=>`${h},${m}`)).fill({color:"white",opacity:.8}).css("cursor","pointer").css("text-align","center").id(`hex-${t.q}-${t.r}`).stroke({width:2,color:"#04548f",opacity:.5});if(nt+=s.cost,!s.set&&!l&&!s.first)q.fill({color:"#000",opacity:.5});else if(!s.set&&l&&!s.first)if(a&&!e(v).every(h=>h.set||h.first))q.fill({color:"#000",opacity:.5});else{const h=n.gradient("linear",function(m){m.stop({offset:.75,color:"#000",opacity:.5}),m.stop({offset:.75,color:"#FFF",opacity:1})}).from(0,0).to(1.2,.8);q.fill(h),s.settable=!0}else s.first||q.fill({color:s.color,opacity:1});n.group().add(q),s?.title&&s.title.split(" ").forEach((h,m)=>{n.text(h).id(`text-${t.q}-${t.r}-${m}`).move(t.corners[0].x-Q/2,t.corners[0].y-14+m*(ct/4)).css("pointer-events","none").css("text-anchor","middle").css("transform","translate(100)").font({family:"pokemon",fill:s.set?"#444":s.color,size:Q/4,weight:"bold",leading:1})})}}function W(t,n,i,f,a){t&&!t.first&&!e(C)&&(b(T,t,!0),V=n,b(k,!0),o=f,b(O,a,!0))}function S(t,n,i,f=!1,a){t.clear(),n.filter(r=>!a||!(a.q===r.q&&a.r===r.r)).forEach(r=>Y(r,t,i,n,f)),a&&Y(a,t,i,n,f)}function j(t,n){b(C,!0);const i=e(v)===n?"initiate":"expert";n===e(v)?S(L,e(x),e(v),!1,o):S(N,e(y),e(w),!0,o),b(k,!1),F.context.player.setMastery(t);const f=[e(O).neighborOf({q:o.q,r:o.r},g.NE,{allowOutside:!1}),e(O).neighborOf({q:o.q,r:o.r},g.NW,{allowOutside:!1}),e(O).neighborOf({q:o.q,r:o.r},g.E,{allowOutside:!1}),e(O).neighborOf({q:o.q,r:o.r},g.W,{allowOutside:!1}),e(O).neighborOf({q:o.q,r:o.r},g.SE,{allowOutside:!1}),e(O).neighborOf({q:o.q,r:o.r},g.SW,{allowOutside:!1})].filter(r=>!!r).filter(r=>{const s=n.find(d=>d.q===r.q&&d.r===r.r);return!s?.set&&!s.settable}).map(r=>"#"+i+" #hex-"+r.q+"-"+r.r),a=qt.timeline();a.to("#"+i+" #hex-"+o.q+"-"+o.r,{scale:1.3,duration:1,repeat:1,transformOrigin:"50% 50%",position:"relative",rotate:180,yoyo:!0},"fx").to("#"+i+" #hex-"+o.q+"-"+o.r,{fill:t.color,fillOpacity:1},"fx").to("#"+i+" #text-"+o.q+"-"+o.r+"-0",{fill:"#444"},"fx").to("#"+i+" #text-"+o.q+"-"+o.r+"-1",{fill:"#444"},"fx"),f.forEach(r=>{a.to(r,{duration:.5,transformOrigin:"50% 50%",scale:.85},"fx+1").to(r,{duration:.5,transformOrigin:"50% 50%",scale:1},"fx+1.5")}),a.play().then(()=>{if(t.group=="novice"){if(S(L,e(x),e(v),!1),b(C,!1),e(v).every(r=>r.set||r.first)){const r=e(w).find(s=>s.first);b(O,e(y),!0),o=e(y).getHex({q:r?.q,r:r?.r}),j(r,e(w))}}else S(N,e(y),e(w),!0),b(C,!1)})}dt(()=>{L=et().addTo(E).size("100%","100%").id("initiate").css("zIndex","-1");const t=rt({dimensions:E.getBoundingClientRect().width/28.4,origin:"topLeft"});b(x,new st(t,ot({width:16,height:1})),!0),S(L,e(x),e(v),!1);function n({target:s,offsetX:d,offsetY:u}){const c=e(x).pointToHex({x:d,y:u},{allowOutside:!1});W(e(v).find(p=>p.q===c.q&&p.r===c.r),e(v),s,c,e(x))}function i({target:s,offsetX:d,offsetY:u}){const c=e(x).pointToHex({x:d,y:u},{allowOutside:!1});W(e(v).find(p=>p.q===c.q&&p.r===c.r),e(v),s,c,e(x))}E.addEventListener("click",n),E.addEventListener("touch",i),N=et().addTo(M).id("expert").size("100%","100%");const f=rt({dimensions:M.getBoundingClientRect().width/26.5,origin:"topLeft"});b(y,new st(f,ot({width:15,height:4})),!0),S(N,e(y),e(w),!0);function a({target:s,offsetX:d,offsetY:u}){const c=e(y).pointToHex({x:d,y:u},{allowOutside:!1});W(e(w).find(p=>p.q===c.q&&p.r===c.r),e(w),s,c,e(y))}function r({target:s,offsetX:d,offsetY:u}){const c=e(y).pointToHex({x:d,y:u},{allowOutside:!1});W(e(w).find(p=>p.q===c.q&&p.r===c.r),e(w),s,c,e(y))}return M.addEventListener("click",a),M.addEventListener("touch",r),()=>{E.removeEventListener("click",n),E.removeEventListener("touch",i),M.removeEventListener("click",a),M.removeEventListener("touch",r)}});var A=bt(),K=_(Z(A),2);tt(K,t=>E=t,()=>E);var D=_(K,2);tt(D,t=>M=t,()=>M);var J=_(D,2),at=z(J),lt=_(J,2);mt(lt,{get showModal(){return e(k)},set showModal(t){b(k,t,!0)},children:(t,n)=>{var i=gt(),f=Z(i),a=z(f),r=_(f,4),s=z(r),d=_(r,4);B(u=>{G(a,`cost : ${e(T)?.cost??""}`),G(s,e(T)?.description),d.disabled=u},[()=>!e(T)?.settable||e(X)<e(T)?.cost||e(O)===e(y)&&!e(v).every(u=>u.set||u.first)]),ut("click",d,()=>{j(e(T),V)}),I(t,i)},$$slots:{default:!0,header:(t,n)=>{var i=yt(),f=z(i);B(()=>G(f,e(T)?.title)),I(t,i)}}}),B(()=>G(at,`${e(X)??""} points`)),I(it,A),pt()}vt(["click"]);export{Tt as default};
