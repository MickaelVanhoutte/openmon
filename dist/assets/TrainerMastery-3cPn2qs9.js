import{p as ft,o as dt,h as e,c as S,C as Z,t as P,k as W,l as B,u as T,f as G,r as ut,s as I,x as z,v as R,d as pt}from"./main-DY229g9u.js";import{b as tt}from"./props-D-3Nyka0.js";import{S as et,n as rt,q as st,a as ot,b as g}from"./mastery-DJiwniJv.js";import{g as vt}from"./index-DDlvirwQ.js";import{M as mt}from"./Modal-BhVozcrY.js";import"./vendor-VFwEZOIt.js";/* empty css            */var qt=R('<p style="margin: 0"> </p> <hr/> <p style="margin: 0"> </p> <hr/> <button class="button primary">Activate</button>',1),gt=R('<h3 slot="header" style="margin: 2% 0"> </h3>'),yt=R('<div class="offset svelte-ub7mba"></div> <div class="masteries svelte-ub7mba"></div> <div class="expert svelte-ub7mba"></div> <span class="points svelte-ub7mba"> </span> <!>',1);function _t(it,H){ft(H,!0);let w,E,k=I(!1),x=I(void 0),V,o,h;const F=z(()=>H.context.player.playerMasteries),X=z(()=>e(F).points),v=z(()=>e(F).novice);let $,M;const O=z(()=>e(F).expert);let L,y,N=I(!1),nt=0;function Y(t,n,i,f,a=!1){function r(l,m,b){return[m.neighborOf({q:l.q,r:l.r},g.NE,{allowOutside:!1}),m.neighborOf({q:l.q,r:l.r},g.NW,{allowOutside:!1}),m.neighborOf({q:l.q,r:l.r},g.E,{allowOutside:!1}),m.neighborOf({q:l.q,r:l.r},g.W,{allowOutside:!1}),m.neighborOf({q:l.q,r:l.r},g.SE,{allowOutside:!1}),m.neighborOf({q:l.q,r:l.r},g.SW,{allowOutside:!1})].filter(q=>!!q).some(q=>{if(b.find(U=>U.q===q.q&&U.r===q.r)?.set)return!0})}const s=i.find(l=>l.q===t.q&&l.r===t.r),d=Math.min(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),u=Math.max(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),c=Math.min(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),p=Math.max(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),Q=Math.abs(p-c),ct=Math.abs(u-d);if(s){const l=r(t,f,i),m=n.polygon(t.corners.map(({x:b,y:q})=>`${b},${q}`)).fill({color:"white",opacity:.8}).css("cursor","pointer").css("text-align","center").id(`hex-${t.q}-${t.r}`).stroke({width:2,color:"#04548f",opacity:.5});if(nt+=s.cost,!s.set&&!l&&!s.first)m.fill({color:"#000",opacity:.5});else if(!s.set&&l&&!s.first)if(a&&!e(v).every(b=>b.set||b.first))m.fill({color:"#000",opacity:.5});else{const b=n.gradient("linear",function(q){q.stop({offset:.75,color:"#000",opacity:.5}),q.stop({offset:.75,color:"#FFF",opacity:1})}).from(0,0).to(1.2,.8);m.fill(b),s.settable=!0}else s.first||m.fill({color:s.color,opacity:1});n.group().add(m),s?.title&&s.title.split(" ").forEach((b,q)=>{n.text(b).id(`text-${t.q}-${t.r}-${q}`).move(t.corners[0].x-Q/2,t.corners[0].y-14+q*(ct/4)).css("pointer-events","none").css("text-anchor","middle").css("transform","translate(100)").font({family:"pokemon",fill:s.set?"#444":s.color,size:Q/4,weight:"bold",leading:1})})}}function C(t,n,i,f,a){t&&!t.first&&!e(N)&&(T(x,t,!0),V=n,T(k,!0),o=f,h=a)}function _(t,n,i,f=!1,a){t.clear(),n.filter(r=>!a||!(a.q===r.q&&a.r===r.r)).forEach(r=>Y(r,t,i,n,f)),a&&Y(a,t,i,n,f)}function A(t,n){T(N,!0);const i=e(v)===n?"initiate":"expert";n===e(v)?_($,M,e(v),!1,o):_(L,y,e(O),!0,o),T(k,!1),H.context.player.setMastery(t);const f=[h.neighborOf({q:o.q,r:o.r},g.NE,{allowOutside:!1}),h.neighborOf({q:o.q,r:o.r},g.NW,{allowOutside:!1}),h.neighborOf({q:o.q,r:o.r},g.E,{allowOutside:!1}),h.neighborOf({q:o.q,r:o.r},g.W,{allowOutside:!1}),h.neighborOf({q:o.q,r:o.r},g.SE,{allowOutside:!1}),h.neighborOf({q:o.q,r:o.r},g.SW,{allowOutside:!1})].filter(r=>!!r).filter(r=>{const s=n.find(d=>d.q===r.q&&d.r===r.r);return!s?.set&&!s.settable}).map(r=>"#"+i+" #hex-"+r.q+"-"+r.r),a=vt.timeline();a.to("#"+i+" #hex-"+o.q+"-"+o.r,{scale:1.3,duration:1,repeat:1,transformOrigin:"50% 50%",position:"relative",rotate:180,yoyo:!0},"fx").to("#"+i+" #hex-"+o.q+"-"+o.r,{fill:t.color,fillOpacity:1},"fx").to("#"+i+" #text-"+o.q+"-"+o.r+"-0",{fill:"#444"},"fx").to("#"+i+" #text-"+o.q+"-"+o.r+"-1",{fill:"#444"},"fx"),f.forEach(r=>{a.to(r,{duration:.5,transformOrigin:"50% 50%",scale:.85},"fx+1").to(r,{duration:.5,transformOrigin:"50% 50%",scale:1},"fx+1.5")}),a.play().then(()=>{if(t.group=="novice"){if(_($,M,e(v),!1),T(N,!1),e(v).every(r=>r.set||r.first)){const r=e(O).find(s=>s.first);h=y,o=y.getHex({q:r?.q,r:r?.r}),A(r,e(O))}}else _(L,y,e(O),!0),T(N,!1)})}dt(()=>{$=et().addTo(w).size("100%","100%").id("initiate").css("zIndex","-1");const t=rt({dimensions:w.getBoundingClientRect().width/28.4,origin:"topLeft"});M=new st(t,ot({width:16,height:1})),_($,M,e(v),!1);function n({target:s,offsetX:d,offsetY:u}){const c=M.pointToHex({x:d,y:u},{allowOutside:!1});C(e(v).find(p=>p.q===c.q&&p.r===c.r),e(v),s,c,M)}function i({target:s,offsetX:d,offsetY:u}){const c=M.pointToHex({x:d,y:u},{allowOutside:!1});C(e(v).find(p=>p.q===c.q&&p.r===c.r),e(v),s,c,M)}w.addEventListener("click",n),w.addEventListener("touch",i),L=et().addTo(E).id("expert").size("100%","100%");const f=rt({dimensions:E.getBoundingClientRect().width/26.5,origin:"topLeft"});y=new st(f,ot({width:15,height:4})),_(L,y,e(O),!0);function a({target:s,offsetX:d,offsetY:u}){const c=y.pointToHex({x:d,y:u},{allowOutside:!1});C(e(O).find(p=>p.q===c.q&&p.r===c.r),e(O),s,c,y)}function r({target:s,offsetX:d,offsetY:u}){const c=y.pointToHex({x:d,y:u},{allowOutside:!1});C(e(O).find(p=>p.q===c.q&&p.r===c.r),e(O),s,c,y)}return E.addEventListener("click",a),E.addEventListener("touch",r),()=>{w.removeEventListener("click",n),w.removeEventListener("touch",i),E.removeEventListener("click",a),E.removeEventListener("touch",r)}});var j=yt(),D=S(Z(j),2);tt(D,t=>w=t,()=>w);var J=S(D,2);tt(J,t=>E=t,()=>E);var K=S(J,2),at=G(K),lt=S(K,2);mt(lt,{get showModal(){return e(k)},set showModal(t){T(k,t,!0)},children:(t,n)=>{var i=qt(),f=Z(i),a=G(f),r=S(f,4),s=G(r),d=S(r,4);d.__click=()=>{A(e(x),V)},P(u=>{W(a,`cost : ${e(x)?.cost??""}`),W(s,e(x)?.description),d.disabled=u},[()=>!e(x)?.settable||e(X)<e(x)?.cost||h===y&&!e(v).every(u=>u.set||u.first)]),B(t,i)},$$slots:{default:!0,header:(t,n)=>{var i=gt(),f=G(i);P(()=>W(f,e(x)?.title)),B(t,i)}}}),P(()=>W(at,`${e(X)??""} points`)),B(it,j),ut()}pt(["click"]);export{_t as default};
