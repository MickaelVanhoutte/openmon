import{p as de,a as pe,o as ue,g as r,s as E,f as U,b as Z,M as ve,t as H,c as z,d as F,e as be,h as w,i as W,j as me,k as P,u as G,l as B}from"./main-BtG9RMYc.js";import{S as ee,n as te,q as re,a as se,b as p}from"./mastery-DJiwniJv.js";import{g as ge}from"./vendor-BmsMGheN.js";/* empty css            */import"./chartjs-CIVOkaCU.js";var qe=B('<p style="margin: 0"> </p> <hr/> <p style="margin: 0"> </p> <hr/> <button class="button primary">Activate</button>',1),ye=B('<h3 slot="header" style="margin: 2% 0"> </h3>'),he=B('<div class="offset svelte-ub7mba"></div> <div class="masteries svelte-ub7mba"></div> <div class="expert svelte-ub7mba"></div> <span class="points svelte-ub7mba"> </span> <!>',1);const we={hash:"svelte-ub7mba",code:".offset.svelte-ub7mba {width:100%;}.masteries.svelte-ub7mba {width:100dvw;height:10dvw;margin-left:1%;overflow:visible;}.masteries svg {overflow:visible;z-index:-1;}.expert.svelte-ub7mba {width:100dvw;height:calc(85dvh - 46px);overflow:visible;}.expert svg {overflow:visible;z-index:-1;}.points.svelte-ub7mba {position:absolute;bottom:0;right:0;padding:8px;font-size:32px;color:white;text-shadow:1px 1px 1px black;}.modal {min-width:60%;}"};function Te(I,L){de(L,!0),pe(I,we);let O,x,S=P(!1),y=P(void 0),R,i,b,C=G(()=>L.context.player.playerMasteries),V=G(()=>r(C).points),c=G(()=>r(C).novice),T,q,m=G(()=>r(C).expert),$,u,N=P(!1),oe=0;function X(e,n,o,l,a=!1){function t(f,d,v){return[d.neighborOf({q:f.q,r:f.r},p.NE,{allowOutside:!1}),d.neighborOf({q:f.q,r:f.r},p.NW,{allowOutside:!1}),d.neighborOf({q:f.q,r:f.r},p.E,{allowOutside:!1}),d.neighborOf({q:f.q,r:f.r},p.W,{allowOutside:!1}),d.neighborOf({q:f.q,r:f.r},p.SE,{allowOutside:!1}),d.neighborOf({q:f.q,r:f.r},p.SW,{allowOutside:!1})].filter(g=>!!g).some(g=>{if(v.find(Q=>Q.q===g.q&&Q.r===g.r)?.set)return!0})}let s=o.find(f=>f.q===e.q&&f.r===e.r),h=Math.min(e.corners[0].y,e.corners[1].y,e.corners[2].y,e.corners[3].y,e.corners[4].y,e.corners[5].y),_=Math.max(e.corners[0].y,e.corners[1].y,e.corners[2].y,e.corners[3].y,e.corners[4].y,e.corners[5].y),le=Math.min(e.corners[0].x,e.corners[1].x,e.corners[2].x,e.corners[3].x,e.corners[4].x,e.corners[5].x),ne=Math.max(e.corners[0].x,e.corners[1].x,e.corners[2].x,e.corners[3].x,e.corners[4].x,e.corners[5].x),K=Math.abs(ne-le),fe=Math.abs(_-h);if(s){let f=t(e,l,o);const d=n.polygon(e.corners.map(({x:v,y:g})=>`${v},${g}`)).fill({color:"white",opacity:.8}).css("cursor","pointer").css("text-align","center").id(`hex-${e.q}-${e.r}`).stroke({width:2,color:"#04548f",opacity:.5});if(oe+=s.cost,!s.set&&!f&&!s.first)d.fill({color:"#000",opacity:.5});else if(!s.set&&f&&!s.first)if(a&&!r(c).every(v=>v.set||v.first))d.fill({color:"#000",opacity:.5});else{var ce=n.gradient("linear",function(v){v.stop({offset:.75,color:"#000",opacity:.5}),v.stop({offset:.75,color:"#FFF",opacity:1})}).from(0,0).to(1.2,.8);d.fill(ce),s.settable=!0}else s.first||d.fill({color:s.color,opacity:1});n.group().add(d),s?.title&&s.title.split(" ").forEach((v,g)=>{n.text(v).id(`text-${e.q}-${e.r}-${g}`).move(e.corners[0].x-K/2,e.corners[0].y-14+g*(fe/4)).css("pointer-events","none").css("text-anchor","middle").css("transform","translate(100)").font({family:"pokemon",fill:s.set?"#444":s.color,size:K/4,weight:"bold",leading:1})})}}function k(e,n,o,l,a){e&&!e.first&&!r(N)&&(w(y,e,!0),R=n,w(S,!0),i=l,b=a)}function M(e,n,o,l=!1,a){e.clear(),n.filter(t=>!a||!(a.q===t.q&&a.r===t.r)).forEach(t=>X(t,e,o,n,l)),a&&X(a,e,o,n,l)}function Y(e,n){w(N,!0);let o=r(c)===n?"initiate":"expert";n===r(c)?M(T,q,r(c),!1,i):M($,u,r(m),!0,i),w(S,!1),L.context.player.setMastery(e);let l=[b.neighborOf({q:i.q,r:i.r},p.NE,{allowOutside:!1}),b.neighborOf({q:i.q,r:i.r},p.NW,{allowOutside:!1}),b.neighborOf({q:i.q,r:i.r},p.E,{allowOutside:!1}),b.neighborOf({q:i.q,r:i.r},p.W,{allowOutside:!1}),b.neighborOf({q:i.q,r:i.r},p.SE,{allowOutside:!1}),b.neighborOf({q:i.q,r:i.r},p.SW,{allowOutside:!1})].filter(t=>!!t).filter(t=>{let s=n.find(h=>h.q===t.q&&h.r===t.r);return!s?.set&&!s.settable}).map(t=>"#"+o+" #hex-"+t.q+"-"+t.r),a=ge.timeline();a.to("#"+o+" #hex-"+i.q+"-"+i.r,{scale:1.3,duration:1,repeat:1,transformOrigin:"50% 50%",position:"relative",rotate:180,yoyo:!0},"fx").to("#"+o+" #hex-"+i.q+"-"+i.r,{fill:e.color,fillOpacity:1},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-0",{fill:"#444"},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-1",{fill:"#444"},"fx"),l.forEach(t=>{a.to(t,{duration:.5,transformOrigin:"50% 50%",scale:.85},"fx+1").to(t,{duration:.5,transformOrigin:"50% 50%",scale:1},"fx+1.5")}),a.play().then(()=>{if(e.group=="novice"){if(M(T,q,r(c),!1),w(N,!1),r(c).every(t=>t.set||t.first)){let t=r(m).find(s=>s.first);b=u,i=u.getHex({q:t?.q,r:t?.r}),Y(t,r(m))}}else M($,u,r(m),!0),w(N,!1)})}ue(()=>{T=ee().addTo(O).size("100%","100%").id("initiate").css("zIndex","-1");const e=te({dimensions:O.getBoundingClientRect().width/28.4,origin:"topLeft"});q=new re(e,se({width:16,height:1})),M(T,q,r(c),!1),O.addEventListener("click",({target:o,offsetX:l,offsetY:a})=>{const t=q.pointToHex({x:l,y:a},{allowOutside:!1});k(r(c).find(s=>s.q===t.q&&s.r===t.r),r(c),o,t,q)}),O.addEventListener("touch",({target:o,offsetX:l,offsetY:a})=>{const t=q.pointToHex({x:l,y:a},{allowOutside:!1});k(r(c).find(s=>s.q===t.q&&s.r===t.r),r(c),o,t,q)}),$=ee().addTo(x).id("expert").size("100%","100%");const n=te({dimensions:x.getBoundingClientRect().width/26.5,origin:"topLeft"});u=new re(n,se({width:15,height:4})),M($,u,r(m),!0),x.addEventListener("click",({target:o,offsetX:l,offsetY:a})=>{const t=u.pointToHex({x:l,y:a},{allowOutside:!1});k(r(m).find(s=>s.q===t.q&&s.r===t.r),r(m),o,t,u)}),x.addEventListener("touch",({target:o,offsetX:l,offsetY:a})=>{const t=u.pointToHex({x:l,y:a},{allowOutside:!1});k(r(m).find(s=>s.q===t.q&&s.r===t.r),r(m),o,t,u)})});var j=he(),A=E(U(j),2);Z(A,e=>O=e,()=>O);var D=E(A,2);Z(D,e=>x=e,()=>x);var J=E(D,2),ie=W(J),ae=E(J,2);ve(ae,{get showModal(){return r(S)},set showModal(e){w(S,e,!0)},children:(e,n)=>{var o=qe(),l=U(o),a=W(l),t=E(l,4),s=W(t),h=E(t,4);H(_=>{z(a,`cost : ${r(y)?.cost??""}`),z(s,r(y)?.description),h.disabled=_},[()=>!r(y)?.settable||r(V)<r(y)?.cost||b===u&&!r(c).every(_=>_.set||_.first)]),be("click",h,()=>{Y(r(y),R)}),F(e,o)},$$slots:{default:!0,header:(e,n)=>{var o=ye(),l=W(o);H(()=>z(l,r(y)?.title)),F(e,o)}}}),H(()=>z(ie,`${r(V)??""} points`)),F(I,j),me()}export{Te as default};
