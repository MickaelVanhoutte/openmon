import{p as ft,a as dt,o as pt,g as r,s as E,f as U,b as Z,M as ut,t as H,c as z,d as F,e as vt,h as w,i as W,j as bt,k as P,u as G,l as B}from"./main-CSVsxsVJ.js";import{S as tt,n as et,q as rt,a as st,b as u}from"./mastery-DJiwniJv.js";import{g as mt}from"./vendor-CCBEPdA4.js";/* empty css            */import"./chartjs-CIVOkaCU.js";var gt=B('<p style="margin: 0"> </p> <hr/> <p style="margin: 0"> </p> <hr/> <button class="button primary">Activate</button>',1),qt=B('<h3 slot="header" style="margin: 2% 0"> </h3>'),yt=B('<div class="offset svelte-ub7mba"></div> <div class="masteries svelte-ub7mba"></div> <div class="expert svelte-ub7mba"></div> <span class="points svelte-ub7mba"> </span> <!>',1);const ht={hash:"svelte-ub7mba",code:".offset.svelte-ub7mba {width:100%;}.masteries.svelte-ub7mba {width:100dvw;height:10dvw;margin-left:1%;overflow:visible;}.masteries svg {overflow:visible;z-index:-1;}.expert.svelte-ub7mba {width:100dvw;height:calc(85dvh - 46px);overflow:visible;}.expert svg {overflow:visible;z-index:-1;}.points.svelte-ub7mba {position:absolute;bottom:0;right:0;padding:8px;font-size:32px;color:white;text-shadow:1px 1px 1px black;}.modal {min-width:60%;}"};function St(I,L){ft(L,!0),dt(I,ht);let O,x,S=P(!1),y=P(void 0),R,i,m;const C=G(()=>L.context.player.playerMasteries),V=G(()=>r(C).points),f=G(()=>r(C).novice);let T,q;const g=G(()=>r(C).expert);let $,v,N=P(!1),ot=0;function X(t,l,o,a,n=!1){function e(c,d,b){return[d.neighborOf({q:c.q,r:c.r},u.NE,{allowOutside:!1}),d.neighborOf({q:c.q,r:c.r},u.NW,{allowOutside:!1}),d.neighborOf({q:c.q,r:c.r},u.E,{allowOutside:!1}),d.neighborOf({q:c.q,r:c.r},u.W,{allowOutside:!1}),d.neighborOf({q:c.q,r:c.r},u.SE,{allowOutside:!1}),d.neighborOf({q:c.q,r:c.r},u.SW,{allowOutside:!1})].filter(p=>!!p).some(p=>{if(b.find(Q=>Q.q===p.q&&Q.r===p.r)?.set)return!0})}const s=o.find(c=>c.q===t.q&&c.r===t.r),h=Math.min(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),_=Math.max(t.corners[0].y,t.corners[1].y,t.corners[2].y,t.corners[3].y,t.corners[4].y,t.corners[5].y),at=Math.min(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),lt=Math.max(t.corners[0].x,t.corners[1].x,t.corners[2].x,t.corners[3].x,t.corners[4].x,t.corners[5].x),K=Math.abs(lt-at),ct=Math.abs(_-h);if(s){const c=e(t,a,o),d=l.polygon(t.corners.map(({x:b,y:p})=>`${b},${p}`)).fill({color:"white",opacity:.8}).css("cursor","pointer").css("text-align","center").id(`hex-${t.q}-${t.r}`).stroke({width:2,color:"#04548f",opacity:.5});if(ot+=s.cost,!s.set&&!c&&!s.first)d.fill({color:"#000",opacity:.5});else if(!s.set&&c&&!s.first)if(n&&!r(f).every(b=>b.set||b.first))d.fill({color:"#000",opacity:.5});else{const b=l.gradient("linear",function(p){p.stop({offset:.75,color:"#000",opacity:.5}),p.stop({offset:.75,color:"#FFF",opacity:1})}).from(0,0).to(1.2,.8);d.fill(b),s.settable=!0}else s.first||d.fill({color:s.color,opacity:1});l.group().add(d),s?.title&&s.title.split(" ").forEach((b,p)=>{l.text(b).id(`text-${t.q}-${t.r}-${p}`).move(t.corners[0].x-K/2,t.corners[0].y-14+p*(ct/4)).css("pointer-events","none").css("text-anchor","middle").css("transform","translate(100)").font({family:"pokemon",fill:s.set?"#444":s.color,size:K/4,weight:"bold",leading:1})})}}function k(t,l,o,a,n){t&&!t.first&&!r(N)&&(w(y,t,!0),R=l,w(S,!0),i=a,m=n)}function M(t,l,o,a=!1,n){t.clear(),l.filter(e=>!n||!(n.q===e.q&&n.r===e.r)).forEach(e=>X(e,t,o,l,a)),n&&X(n,t,o,l,a)}function Y(t,l){w(N,!0);const o=r(f)===l?"initiate":"expert";l===r(f)?M(T,q,r(f),!1,i):M($,v,r(g),!0,i),w(S,!1),L.context.player.setMastery(t);const a=[m.neighborOf({q:i.q,r:i.r},u.NE,{allowOutside:!1}),m.neighborOf({q:i.q,r:i.r},u.NW,{allowOutside:!1}),m.neighborOf({q:i.q,r:i.r},u.E,{allowOutside:!1}),m.neighborOf({q:i.q,r:i.r},u.W,{allowOutside:!1}),m.neighborOf({q:i.q,r:i.r},u.SE,{allowOutside:!1}),m.neighborOf({q:i.q,r:i.r},u.SW,{allowOutside:!1})].filter(e=>!!e).filter(e=>{const s=l.find(h=>h.q===e.q&&h.r===e.r);return!s?.set&&!s.settable}).map(e=>"#"+o+" #hex-"+e.q+"-"+e.r),n=mt.timeline();n.to("#"+o+" #hex-"+i.q+"-"+i.r,{scale:1.3,duration:1,repeat:1,transformOrigin:"50% 50%",position:"relative",rotate:180,yoyo:!0},"fx").to("#"+o+" #hex-"+i.q+"-"+i.r,{fill:t.color,fillOpacity:1},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-0",{fill:"#444"},"fx").to("#"+o+" #text-"+i.q+"-"+i.r+"-1",{fill:"#444"},"fx"),a.forEach(e=>{n.to(e,{duration:.5,transformOrigin:"50% 50%",scale:.85},"fx+1").to(e,{duration:.5,transformOrigin:"50% 50%",scale:1},"fx+1.5")}),n.play().then(()=>{if(t.group=="novice"){if(M(T,q,r(f),!1),w(N,!1),r(f).every(e=>e.set||e.first)){const e=r(g).find(s=>s.first);m=v,i=v.getHex({q:e?.q,r:e?.r}),Y(e,r(g))}}else M($,v,r(g),!0),w(N,!1)})}pt(()=>{T=tt().addTo(O).size("100%","100%").id("initiate").css("zIndex","-1");const t=et({dimensions:O.getBoundingClientRect().width/28.4,origin:"topLeft"});q=new rt(t,st({width:16,height:1})),M(T,q,r(f),!1),O.addEventListener("click",({target:o,offsetX:a,offsetY:n})=>{const e=q.pointToHex({x:a,y:n},{allowOutside:!1});k(r(f).find(s=>s.q===e.q&&s.r===e.r),r(f),o,e,q)}),O.addEventListener("touch",({target:o,offsetX:a,offsetY:n})=>{const e=q.pointToHex({x:a,y:n},{allowOutside:!1});k(r(f).find(s=>s.q===e.q&&s.r===e.r),r(f),o,e,q)}),$=tt().addTo(x).id("expert").size("100%","100%");const l=et({dimensions:x.getBoundingClientRect().width/26.5,origin:"topLeft"});v=new rt(l,st({width:15,height:4})),M($,v,r(g),!0),x.addEventListener("click",({target:o,offsetX:a,offsetY:n})=>{const e=v.pointToHex({x:a,y:n},{allowOutside:!1});k(r(g).find(s=>s.q===e.q&&s.r===e.r),r(g),o,e,v)}),x.addEventListener("touch",({target:o,offsetX:a,offsetY:n})=>{const e=v.pointToHex({x:a,y:n},{allowOutside:!1});k(r(g).find(s=>s.q===e.q&&s.r===e.r),r(g),o,e,v)})});var j=yt(),A=E(U(j),2);Z(A,t=>O=t,()=>O);var D=E(A,2);Z(D,t=>x=t,()=>x);var J=E(D,2),it=W(J),nt=E(J,2);ut(nt,{get showModal(){return r(S)},set showModal(t){w(S,t,!0)},children:(t,l)=>{var o=gt(),a=U(o),n=W(a),e=E(a,4),s=W(e),h=E(e,4);H(_=>{z(n,`cost : ${r(y)?.cost??""}`),z(s,r(y)?.description),h.disabled=_},[()=>!r(y)?.settable||r(V)<r(y)?.cost||m===v&&!r(f).every(_=>_.set||_.first)]),vt("click",h,()=>{Y(r(y),R)}),F(t,o)},$$slots:{default:!0,header:(t,l)=>{var o=qt(),a=W(o);H(()=>z(a,r(y)?.title)),F(t,o)}}}),H(()=>z(it,`${r(V)??""} points`)),F(I,j),bt()}export{St as default};
