import{p as k,G as w,z as I,i,B as E,C as F,m as z,c as R,f as W,h as B,H as D,K as q,s as H,y as u,l as K,j as N}from"./threlte-Cn4q_HKN.js";import{f as j}from"./main-72CVvqhh.js";import"./threejs-D-3vx0wo.js";import"./vendor-CHMVvq2h.js";/* empty css            */var G=K('<div class="dungeon-minimap svelte-753byz"><canvas class="svelte-753byz"></canvas></div>');function p(Y,e){k(e,!0);const A=w(e,"visible",3,!0),s=220,X="#ffffff",L="#ffd700",P="#cc44ff",m=.3,C="#3a3a3a",O="#c8b89a";let c=B(void 0);const t=u(()=>Math.min(s/e.width,s/e.height)),h=u(()=>(s-e.width*i(t))/2),y=u(()=>(s-e.height*i(t))/2);function v(a){return j.get(a)??!1?O:C}function S(a){a.clearRect(0,0,s,s),a.fillStyle="rgba(0, 0, 0, 0)",a.fillRect(0,0,s,s),a.globalAlpha=m;for(let l=0;l<e.height;l++)for(let n=0;n<e.width;n++)if(!e.explorationTracker.isVisible(n,l,e.playerX,e.playerY)&&e.explorationTracker.isVisited(n,l)){const o=e.tiles[l][n];a.fillStyle=v(o),a.fillRect(i(h)+n*i(t),i(y)+l*i(t),i(t),i(t))}a.globalAlpha=1;for(let l=0;l<e.height;l++)for(let n=0;n<e.width;n++)if(e.explorationTracker.isVisible(n,l,e.playerX,e.playerY)){const o=e.tiles[l][n];a.fillStyle=v(o),a.fillRect(i(h)+n*i(t),i(y)+l*i(t),i(t),i(t))}if(e.stairsX!==void 0&&e.stairsY!==void 0){const l=e.explorationTracker.isVisible(e.stairsX,e.stairsY,e.playerX,e.playerY),n=e.explorationTracker.isVisited(e.stairsX,e.stairsY);if(l||n){a.globalAlpha=l?1:m,a.fillStyle=L;const o=i(h)+e.stairsX*i(t)+i(t)/2,g=i(y)+e.stairsY*i(t)+i(t)/2,b=Math.max(i(t)*.6,2);a.beginPath(),a.arc(o,g,b,0,Math.PI*2),a.fill(),a.globalAlpha=1}}if(e.legendaryPortals)for(const l of e.legendaryPortals){const n=e.explorationTracker.isVisible(l.x,l.y,e.playerX,e.playerY),o=e.explorationTracker.isVisited(l.x,l.y);if(n||o){a.globalAlpha=n?1:m,a.fillStyle=P;const g=i(h)+l.x*i(t)+i(t)/2,b=i(y)+l.y*i(t)+i(t)/2,M=Math.max(i(t)*.6,2);a.beginPath(),a.arc(g,b,M,0,Math.PI*2),a.fill(),a.globalAlpha=1}}a.fillStyle=X;const r=i(h)+e.playerX*i(t)+i(t)/2,f=i(y)+e.playerY*i(t)+i(t)/2,d=Math.max(i(t)*.7,2.5);a.beginPath(),a.arc(r,f,d,0,Math.PI*2),a.fill(),a.fillStyle="#ffffff",a.font="10px monospace",a.textAlign="right",a.textBaseline="top",a.fillText(`F${e.floorNumber}`,24,4)}I(()=>{if(!i(c)||!A())return;const a=window.devicePixelRatio||1;i(c).width=s*a,i(c).height=s*a;const r=i(c).getContext("2d");if(!r)return;r.scale(a,a);let f,d=-1,l=-1;function n(){r&&((e.playerX!==d||e.playerY!==l)&&(d=e.playerX,l=e.playerY,S(r)),f=requestAnimationFrame(n))}return f=requestAnimationFrame(n),()=>{cancelAnimationFrame(f)}});var _=E(),T=F(_);{var V=a=>{var r=G(),f=N(r);D(f,"width: 220px; height: 220px;"),q(f,d=>H(c,d),()=>i(c)),R(a,r)};z(T,a=>{A()&&a(V)})}R(Y,_),W()}export{p as default};
