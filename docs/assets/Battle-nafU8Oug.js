import{d as at,p as We,h as X,A as ke,M as tt,o as je,e as xe,a as y,j as o,t as Z,i as e,q as be,n as ce,r as ne,H as ve,b as ye,s as i,c as g,k as _e,m as J,K as Le,L as lt,f as Fe,y as Y,B as Ae,C as ue,l as C,G as te,N as It,z as Te,u as vt,I as Mt,O as Tt,R as $e,W as zt,V as Lt}from"./threlte-CLL4P1-_.js";import{g as Se}from"./gsap-DDlvirwQ.js";import{t as pt,k as Ht,P as ut,U as mt,l as rt,m as gt,n as Et,R as Bt,o as Ot,p as yt,a as ht,q as Rt,W as Me,H as De,r as Qe,s as Dt}from"./main-qJhSSQsi.js";import"./vendor-CHMVvq2h.js";import{i as bt,M as Wt}from"./Modal-DtOHyKyd.js";import{C as wt,R as Ft,a as Gt,P as Yt,L as Nt,i as Xt}from"./chartjs-CIVOkaCU.js";import{f as Ut}from"./index-BI5KFv7B.js";import{r as xt,c as _t,p as At,w as St,a as Jt,b as Vt,d as Zt,e as jt,A as Kt}from"./other-CcvOTIaK.js";import"./threejs-4A5RaTDs.js";/* empty css            */var Qt=C('<div role="button" tabindex="0"><img class="svelte-1ua52qc"/> <span class="svelte-1ua52qc"> </span> <div class="hp-status svelte-1ua52qc"><div class="hp svelte-1ua52qc"><span class="svelte-1ua52qc">HP</span> <div class="progressbar-wrapper svelte-1ua52qc"><span class="hp-value svelte-1ua52qc"> </span> <div></div></div></div></div></div>'),$t=C('<p class="svelte-1ua52qc">Select a different Pokémon to launch a <strong class="svelte-1ua52qc">unison attack</strong></p>'),ea=C(`<p class="svelte-1ua52qc"><strong class="svelte-1ua52qc"> </strong> will join the battle to launch <strong class="svelte-1ua52qc"> </strong> </p> <p class="svelte-1ua52qc">The damage of this move will be halved but both moves have a bonus in accuracy and
							effect chances.</p> <button class="combo-btn shine svelte-1ua52qc"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920.000000 1920.000000" preserveAspectRatio="xMidYMid meet" class="svelte-1ua52qc"><defs class="svelte-1ua52qc"><linearGradient id="myGradient2" x2="1" y2="1" class="svelte-1ua52qc"><stop offset="0%" stop-color="#01a9da" class="svelte-1ua52qc"></stop><stop offset="20%" stop-color="#e876ac" class="svelte-1ua52qc"></stop></linearGradient><linearGradient id="myGradient3" x2="1" y2="1" class="svelte-1ua52qc"><stop offset="0%" stop-color="#00a658" class="svelte-1ua52qc"></stop><stop offset="50%" stop-color="#01a9da" class="svelte-1ua52qc"></stop><stop offset="100%" stop-color="#e876ac" class="svelte-1ua52qc"></stop></linearGradient><linearGradient id="myGradient4" x2="1" y2="1" class="svelte-1ua52qc"><stop offset="0%" stop-color="#f4e90e" class="svelte-1ua52qc"></stop><stop offset="33%" stop-color="#00a658" class="svelte-1ua52qc"></stop><stop offset="90%" stop-color="#01a9da" class="svelte-1ua52qc"></stop><stop offset="100%" stop-color="#e876ac" class="svelte-1ua52qc"></stop></linearGradient><linearGradient id="myGradient5" x2="1" y2="1" class="svelte-1ua52qc"><stop offset="0%" stop-color="#f4e90e" class="svelte-1ua52qc"></stop><stop offset="100%" stop-color="#00a658" class="svelte-1ua52qc"></stop></linearGradient></defs><g transform="translate(0.000000,1920.000000) scale(0.100000,-0.100000)" stroke="none" class="svelte-1ua52qc"><path fill="url(#myGradient2)" d="M14625 16153 c-213 -182 -365 -323 -599 -553 -398 -393 -707 -738
-1093 -1219 l-132 -164 182 -91 c278 -140 470 -268 639 -425 42 -39 80 -71 84
-70 5 0 54 57 109 126 450 567 1017 1161 1477 1549 64 55 117 101 117 104 1 7
-678 814 -687 818 -4 1 -48 -32 -97 -75z" class="svelte-1ua52qc"></path><path fill="url(#myGradient3)" d="M11375 14259 c-483 -58 -957 -257 -1345 -566 -111 -88 -329 -305
-414 -413 -279 -354 -563 -876 -886 -1630 -152 -355 -747 -1868 -738 -1875 2
-1 93 -7 203 -14 110 -7 340 -23 510 -36 171 -13 332 -25 358 -26 l49 -3 162
419 c586 1512 883 2130 1208 2520 319 382 821 598 1288 556 239 -22 422 -76
666 -196 237 -117 355 -210 469 -369 367 -515 301 -1483 -149 -2165 -82 -125
-109 -157 -219 -269 -243 -247 -565 -422 -998 -542 l-116 -33 -107 -229 c-181
-385 -422 -935 -414 -943 5 -6 189 18 388 50 928 151 1651 510 2124 1055 420
483 684 1094 782 1805 26 184 26 630 1 800 -60 405 -177 733 -364 1020 -220
338 -495 576 -903 780 -300 150 -572 239 -886 291 -118 19 -548 28 -669 13z" class="svelte-1ua52qc"></path><path fill="url(#myGradient4)" d="M11897 12952 c-457 -692 -995 -1615 -1449 -2487 -440 -845 -653
-1317 -1092 -2423 -281 -705 -456 -1100 -612 -1373 -71 -125 -223 -353 -297
-444 -310 -384 -736 -644 -1211 -740 -68 -14 -137 -25 -153 -25 -38 0 -43 -4
-158 -145 -182 -222 -319 -375 -599 -669 -94 -98 -171 -184 -171 -189 0 -11
120 -36 305 -64 88 -13 181 -17 395 -18 242 0 300 3 427 23 920 142 1681 636
2210 1432 133 202 242 395 374 665 141 290 225 487 514 1210 378 945 481 1178
809 1835 518 1037 1001 1888 1533 2702 l110 168 -36 57 c-43 72 -116 157 -179
212 -108 92 -345 212 -532 269 -161 49 -158 49 -188 4z" class="svelte-1ua52qc"></path><path fill="url(#myGradient5)" d="M7180 9600 c-593 -45 -1004 -172 -1388 -427 -332 -220 -632 -553
-886 -982 -164 -276 -307 -600 -390 -881 -119 -401 -139 -851 -56 -1234 61
-278 208 -587 390 -817 l38 -49 264 278 c336 353 478 508 478 522 0 6 -13 34
-29 63 -39 69 -85 205 -102 297 -19 103 -16 322 6 445 75 435 364 973 671
1254 283 259 634 398 1119 441 208 19 772 5 1210 -30 467 -36 820 -58 827 -52
4 4 64 142 133 307 69 165 169 398 221 518 53 121 94 220 92 222 -2 2 -100 8
-218 14 -255 14 -490 30 -1095 77 -485 37 -1047 52 -1285 34z" class="svelte-1ua52qc"></path><path fill="url(#myGradient5)" d="M7393 8338 c-5 -7 -33 -65 -63 -128 -144 -307 -282 -555 -499 -895
-369 -580 -796 -1142 -1202 -1581 -787 -850 -1346 -1406 -1687 -1677 -48 -38
-102 -81 -119 -95 l-33 -27 245 -475 c135 -261 246 -479 248 -485 9 -25 440
316 706 559 455 415 1583 1616 1942 2068 430 541 861 1179 1133 1676 132 240
495 1006 483 1018 -4 4 -382 32 -602 44 -265 14 -540 13 -552 -2z" class="svelte-1ua52qc"></path></g></svg></button>`,1),ta=C('<div class="combo-info svelte-1ua52qc"><!></div>'),aa=C('<p class="svelte-1ua52qc">Select a different Pokémon to switch</p>'),na=C('<p class="svelte-1ua52qc"><strong class="svelte-1ua52qc"> </strong> will join the battle</p>'),sa=C('<div class="switch svelte-1ua52qc"><!> <button class="button btn-switch svelte-1ua52qc"><span class="svelte-1ua52qc">SWITCH</span> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-1ua52qc"><path d="M16 16V12L21 17L16 22V18H4V16H16ZM8 2V5.999L20 6V8H8V12L3 7L8 2Z" class="svelte-1ua52qc"></path></svg></button></div>'),ra=C('<div class="move-btn move svelte-1ua52qc"><span class="move-type svelte-1ua52qc"><svg fill="currentColor" class="svelte-1ua52qc"></svg></span> <span class="move-name svelte-1ua52qc"> </span> <span class="move-pp svelte-1ua52qc"> </span></div>'),ia=C('<button><span class="move-type svelte-1ua52qc"><svg fill="currentColor" class="svelte-1ua52qc"></svg></span> <span class="move-name svelte-1ua52qc"> </span> <span class="move-pp svelte-1ua52qc"> </span></button>'),oa=C('<div class="mini-pkmn-menu svelte-1ua52qc"><div class="head svelte-1ua52qc"></div> <div class="body svelte-1ua52qc"><div class="actions svelte-1ua52qc"><!></div> <div class="stats svelte-1ua52qc"><div class="stats-wrapper svelte-1ua52qc"><canvas class="svelte-1ua52qc"></canvas></div></div> <div class="moves svelte-1ua52qc"><!></div></div></div>');function la(A,n){We(n,!0),wt.register(Ft,Gt,Yt,Nt,Xt);let t=X(ke(tt(()=>n.currentPkmn))),s=X(0),F=X(void 0),_=X(void 0),d;je(()=>{if(d){const z=d.querySelector(".head"),l=d.querySelector(".body");Se.fromTo(d,{opacity:0},{opacity:1,duration:.2,ease:"power2.out"}),z&&Se.fromTo(z.children,{opacity:0,y:-15},{opacity:1,y:0,duration:.3,stagger:.04,ease:"power2.out",delay:.1}),l&&Se.fromTo(l.children,{opacity:0,y:20},{opacity:1,y:0,duration:.3,stagger:.08,ease:"power2.out",delay:.2})}});const B=Y(()=>({labels:[["HP",e(t).currentStats.hp],["Attack",e(t).currentStats.attack],["Defense",e(t).currentStats.defense],["Speed",e(t).currentStats.speed],["Sp. Def",e(t).currentStats.specialDefense],["Sp. Atk",e(t).currentStats.specialAttack]],datasets:[{label:"current",data:[e(t).currentStats.hp,e(t).currentStats.attack,e(t).currentStats.defense,e(t).currentStats.speed,e(t).currentStats.specialDefense,e(t).currentStats.specialAttack],fill:!0,backgroundColor:"rgba(100, 180, 255, 0.25)",borderColor:"rgba(100, 180, 255, 0.8)",borderWidth:2,pointBorderWidth:0,pointStyle:!1,spanGaps:!0,tension:0},{label:"EVs",data:[e(t).evs.hp,e(t).evs.attack,e(t).evs.defense,e(t).evs.speed,e(t).evs.specialDefense,e(t).evs.specialAttack],fill:!0,backgroundColor:"rgba(80, 150, 230, 0.15)",borderColor:"rgba(80, 150, 230, 0.6)",borderWidth:2,pointBorderWidth:0,pointStyle:!1,spanGaps:!0,tension:0}]})),D=Y(()=>({type:"radar",data:e(B),responsive:!0,maintainAspectRatio:!1,options:{scales:{r:{min:-30,max:Math.max(Math.max(...Object.values({...e(t).currentStats,total:0})),Math.max(...Object.values({...e(t).evs,total:0}))),beginAtZero:!0,pointLabels:{display:!0,color:[E("hp",e(t).nature),E("attack",e(t).nature),E("defense",e(t).nature),E("speed",e(t).nature),E("specialDefense",e(t).nature),E("specialAttack",e(t).nature)],font:{size:18,family:"pokemon, serif",weight:"500"}},ticks:{display:!1,maxTicksLimit:3,color:"white"},grid:{color:"rgba(255, 255, 255, 0.12)"},angleLines:{color:"rgba(255, 255, 255, 0.12)"},gridLines:{display:!1}}},plugins:{legend:{display:!1},title:{display:!1},datalabels:{display:!1}},elements:{line:{borderWidth:2}}}}));function E(z,l){return l.increasedStatId===l.decreasedStatId?"rgba(200, 210, 230, 0.9)":l.increasedStatId===z?"#fb607c":l.decreasedStatId===z?"#50aeff":"rgba(200, 210, 230, 0.9)"}function x(z){const l=new wt(z,e(D));return{update(k){l.data=k.data,l.config.options=e(D).options,l.update("none")},destroy(){l.destroy()}}}var b=oa(),V=o(b);xe(V,21,()=>n.context.player.monsters,_e,(z,l)=>{var k=Qt();let G;var M=o(k),R=y(M,2),v=o(R),u=y(R,2),m=o(u),w=y(o(m),2),p=o(w),P=o(p),H=y(p,2);let K;Z(oe=>{G=be(k,1,"pkmn svelte-1ua52qc",null,G,{out:e(l).fainted,selected:e(l)===e(t)}),ce(k,"aria-label",`Select ${e(l).name??""}, HP ${e(l).currentHp??""} of ${e(l).currentStats.hp??""}`),ce(M,"src",oe),ce(M,"alt",e(l).name),ne(v,e(l).name),ne(P,`${e(l).currentHp??""} / ${e(l).currentStats.hp??""}`),K=be(H,1,"progressbar svelte-1ua52qc",null,K,{warning:e(l).currentHp/e(l).currentStats.hp*100<=50,danger:e(l).currentHp/e(l).currentStats.hp*100<15}),ve(H,`--width:${e(l).currentHp/e(l).currentStats.hp*100+"%"}`)},[()=>e(l).getSprite()]),ye("click",k,()=>i(t,e(l),!0)),ye("keydown",k,oe=>{(oe.key==="Enter"||oe.key===" ")&&i(t,e(l),!0)}),g(z,k)});var O=y(V,2),N=o(O),U=o(N);{var ee=z=>{var l=ta(),k=o(l);{var G=R=>{var v=$t();g(R,v)},M=R=>{var v=ea(),u=ue(v),m=o(u),w=o(m),p=y(m,2),P=o(p),H=y(p),K=y(u,4);Z(()=>{ne(w,e(t).name),ne(P,e(t).moves[e(s)].name),ne(H,` with ${n.currentPkmn.name??""}`),ce(K,"aria-label",`Use combo with ${e(t).name??""}`),K.disabled=e(t)===n.currentPkmn||e(t).fainted}),ye("click",K,()=>n.onCombo({pokemon:e(t),move:e(t).moves[e(s)]})),g(R,v)};J(k,R=>{e(t)===n.currentPkmn?R(G):R(M,!1)})}g(z,l)},I=z=>{var l=sa(),k=o(l);{var G=v=>{var u=aa();g(v,u)},M=v=>{var u=na(),m=o(u),w=o(m);Z(()=>ne(w,e(t).name)),g(v,u)};J(k,v=>{e(t)===n.currentPkmn?v(G):v(M,!1)})}var R=y(k,2);Z(()=>R.disabled=e(t)===n.currentPkmn||e(t).fainted),ye("click",R,()=>n.onChange(e(t))),g(z,l)};J(U,z=>{n.type==="combo"&&e(t)?z(ee):z(I,!1)})}var T=y(N,2),c=o(T),q=o(c);Le(q,z=>i(_,z),()=>e(_)),lt(q,(z,l)=>x?.(z),()=>(e(B),e(D))),Le(c,z=>i(F,z),()=>e(F));var W=y(T,2),j=o(W);{var re=z=>{var l=Ae(),k=ue(l);xe(k,17,()=>e(t)?.moves,_e,(G,M)=>{var R=ra(),v=o(R),u=o(v);lt(u,(H,K)=>bt?.(H,K),()=>`src/assets/types/${e(M).type}.svg`);var m=y(v,2),w=o(m),p=y(m,2),P=o(p);Z(H=>{ve(R,`--color:${pt[e(M).type].color??""};`),ne(w,H),ne(P,`${e(M).currentPp??""}/${e(M).pp??""}`)},[()=>e(M).name.toUpperCase()]),g(G,R)}),g(z,l)},L=z=>{var l=Ae(),k=ue(l);xe(k,17,()=>e(t).moves,_e,(G,M,R)=>{var v=ia();let u;var m=o(v),w=o(m);lt(w,(oe,Q)=>bt?.(oe,Q),()=>`src/assets/types/${e(M).type}.svg`);var p=y(m,2),P=o(p),H=y(p,2),K=o(H);Z(oe=>{u=be(v,1,"move-btn move svelte-1ua52qc",null,u,{selected:e(s)===R}),ve(v,`--color:${pt[e(M).type].color??""};`),ne(P,oe),ne(K,`${e(M).currentPp??""}/${e(M).pp??""}`)},[()=>e(M).name.toUpperCase()]),ye("click",v,()=>i(s,R,!0)),g(G,v)}),g(z,l)};J(j,z=>{n.type!=="combo"?z(re):z(L,!1)})}Le(b,z=>d=z,()=>d),Z(()=>ve(b,`--zIndex: ${n.zIndex??""}`)),g(A,b),Fe()}at(["click","keydown"]);var ca=C('<button role="tab" type="button">Pokeballs</button>'),da=C('<li class="svelte-8y9qqw"><div role="option" tabindex="0"><span> </span> <span> </span></div></li>'),va=C('<li class="svelte-8y9qqw"><div class="poke svelte-8y9qqw"><button class="button svelte-8y9qqw">Use</button> <img class="svelte-8y9qqw"/> <div class="hp-status svelte-8y9qqw"><div class="hp svelte-8y9qqw"><span class="svelte-8y9qqw">HP</span> <div class="progressbar-wrapper svelte-8y9qqw"><span class="hp-value svelte-8y9qqw"> </span> <div></div></div></div></div></div></li>'),ua=C('<div class="pokes svelte-8y9qqw"><ul class="svelte-8y9qqw"></ul></div>'),fa=C('<div class="pokes svelte-8y9qqw" style="height: calc(100% / 8); margin-top: 10%"><ul class="svelte-8y9qqw"><li style="height: 100%" class="svelte-8y9qqw"><div class="poke catch svelte-8y9qqw" style="height: 100%"><button class="button svelte-8y9qqw" aria-label="Catch wild Pokemon">Catch</button> <img class="svelte-8y9qqw"/> <div class="hp-status svelte-8y9qqw"><div class="hp svelte-8y9qqw"><span class="svelte-8y9qqw">HP</span> <div class="progressbar-wrapper svelte-8y9qqw"><div></div></div></div></div></div></li></ul></div>'),pa=C('<div class="mini-bag svelte-8y9qqw"><nav class="nav svelte-8y9qqw" aria-label="Battle bag"><div class="nav-left"><div class="tabs svelte-8y9qqw" role="tablist"><button role="tab" type="button">Healing</button> <button role="tab" type="button">Revive</button> <!></div></div> <div class="items svelte-8y9qqw"><div class="item-list svelte-8y9qqw"><ul class="svelte-8y9qqw"></ul></div></div></nav> <!></div>');function ma(A,n){We(n,!0);const t=te(n,"onChange",3,()=>{}),s={0:"potions",1:"revives",2:"balls"},F=tt(()=>n.battleCtx.isWild);let _=X(0),d=X(0),B=X(void 0);const D=Y(()=>F?n.battleCtx.opponent:void 0);je(()=>{e(B)&&Se.fromTo(e(B).children,{opacity:0,y:20},{opacity:1,y:0,duration:.3,stagger:.05,ease:"power2.out"})});const E=Y(()=>Object.keys(n.context.player.bag[s[e(_)]])?.map(v=>[v,n.context.player.bag[s[e(_)]][v]])),x=Y(()=>e(E)&&e(E)[e(d)]?.[0]||void 0),b=Y(()=>n.context.ITEMS.getItem(e(x))),V=Y(()=>s[e(_)]==="potions"&&n.currentPkmn.currentHp===n.currentPkmn.currentStats.hp||s[e(_)]==="revives"&&!n.currentPkmn.fainted);function O(){const v=n.context.ITEMS.getItem(e(x))?.instanciate();v&&v instanceof ut&&t()(new mt(e(x)))}function N(v){const u=n.context.ITEMS.getItem(e(x))?.instanciate(),m=n.context.player.monsters[v];u&&!(u instanceof ut)&&t()(new mt(e(x),m))}var U=pa(),ee=o(U),I=o(ee),T=o(I),c=o(T);let q;var W=y(c,2);let j;var re=y(W,2);{var L=v=>{var u=ca();let m;Z(()=>{ce(u,"aria-selected",e(_)===2),m=be(u,1,"svelte-8y9qqw",null,m,{active:e(_)===2})}),ye("click",u,()=>i(_,2)),g(v,u)};J(re,v=>{F&&v(L)})}var z=y(I,2),l=o(z),k=o(l);xe(k,21,()=>e(E),_e,(v,u,m)=>{var w=Y(()=>It(e(u),2));let p=()=>e(w)[0],P=()=>e(w)[1];var H=da(),K=o(H);let oe;var Q=o(K),se=o(Q),fe=y(Q,2),pe=o(fe);Z(ie=>{oe=be(K,1,"item svelte-8y9qqw",null,oe,{selected:e(d)===m}),ce(K,"aria-selected",e(d)===m),ne(se,ie),ne(pe,`x ${P()??""}`)},[()=>n.context.ITEMS.getItem(p())?.name]),ye("click",K,()=>{i(d,m,!0)}),ye("keydown",K,ie=>{(ie.key==="Enter"||ie.key===" ")&&i(d,m,!0)}),g(v,H)});var G=y(ee,2);{var M=v=>{var u=ua(),m=o(u);xe(m,21,()=>n.context.player.monsters,_e,(w,p,P)=>{var H=va(),K=o(H),oe=o(K),Q=y(oe,2),se=y(Q,2),fe=o(se),pe=y(o(fe),2),ie=o(pe),he=o(ie),Ee=y(ie,2);let Pe;Z(Je=>{oe.disabled=e(V),ce(oe,"aria-label",`Use item on ${e(p).name??""}`),ce(Q,"src",Je),ce(Q,"alt",e(p).name),ne(he,`${e(p).currentHp??""} / ${e(p).currentStats.hp??""}`),Pe=be(Ee,1,"progressbar svelte-8y9qqw",null,Pe,{warning:e(p).currentHp/e(p).currentStats.hp*100<=50,danger:e(p).currentHp/e(p).currentStats.hp*100<15}),ve(Ee,`--width:${e(p).currentHp/e(p).currentStats.hp*100+"%"}`)},[()=>e(p).getSprite()]),ye("click",oe,()=>N(P)),g(w,H)}),g(v,u)},R=v=>{var u=fa(),m=o(u),w=o(m),p=o(w),P=o(p),H=y(P,2),K=y(H,2),oe=o(K),Q=y(o(oe),2),se=o(Q);let fe;Z(pe=>{ce(p,"data-rate",pe),ce(H,"src",e(D)?.sprites?.[e(D)?.gender]?.front[e(D).isShiny?"shiny1":"frame1"]||e(D)?.sprites?.male?.front[e(D).isShiny?"shiny1":"frame1"]),ce(H,"alt",e(D)?.name),fe=be(se,1,"progressbar svelte-8y9qqw",null,fe,{warning:e(D).currentHp/e(D).currentStats.hp*100<=50,danger:e(D).currentHp/e(D).currentStats.hp*100<15}),ve(se,`--width:${e(D).currentHp/e(D).currentStats.hp*100+"%"}`)},[()=>`Catch rate: ${Math.floor(Ht(e(D),e(b)?.power||0)*100)}%`]),ye("click",P,()=>O()),g(v,u)};J(G,v=>{e(_)!==2?v(M):v(R,!1)})}Le(U,v=>i(B,v),()=>e(B)),Z(()=>{ve(U,`--zIndex: ${n.zIndex??""}`),ce(c,"aria-selected",e(_)===0),q=be(c,1,"svelte-8y9qqw",null,q,{active:e(_)===0}),ce(W,"aria-selected",e(_)===1),j=be(W,1,"svelte-8y9qqw",null,j,{active:e(_)===1})}),ye("click",c,()=>i(_,0)),ye("click",W,()=>i(_,1)),g(A,U),Fe()}at(["click","keydown"]);function ft(A){if(!A)return null;const n=A.getBoundingClientRect();return{x:n.left,y:n.top,width:n.width,height:n.height}}function ga(A,n){const t=Math.max(1,Math.min(4,n)),s=window.innerHeight||600,F=window.innerWidth||800;if(!A)return[{top:45,left:8,rotation:-2},{top:45,left:38,rotation:2},{top:60,left:8,rotation:-2},{top:60,left:38,rotation:2}].slice(0,t);const _={x:A.x+A.width/2,y:A.y+A.height/2},d=A.width*.7+80,B=50,D=_.x-d,E=_.x+d-150,x=_.y-B,b=_.y+B-35,V=Math.max(0,D/F*100),O=Math.max(0,E/F*100),N=Math.max(0,x/s*100),U=Math.max(0,b/s*100);return[{top:N-10,left:V,rotation:-1},{top:N,left:O,rotation:1},{top:U-10,left:V,rotation:-1},{top:U,left:O,rotation:1}].slice(0,t)}var ya=C('<button role="menuitem"><div class="card-body svelte-m40kti"><span class="action-label svelte-m40kti"> </span></div></button>');function ha(A,n){We(n,!0);const t=te(n,"disabled",3,!1),s=te(n,"selectedOptionIdx",3,0),F=te(n,"show",3,!0),_=te(n,"onFight",3,()=>{}),d=te(n,"onBag",3,()=>{}),B=te(n,"onSwitch",3,()=>{}),D=te(n,"onRun",3,()=>{}),E=te(n,"onHover",3,()=>{}),x=te(n,"spriteElement",3,null),b=te(n,"entranceDelay",3,0),V=te(n,"isInitialEntrance",3,!0),O=[];let N=X(ke(tt(()=>s()))),U=X(!1);function ee(){if(!x())return!1;const l=x().getBoundingClientRect();return l.x>0||l.y>0}function I(){ee()?(i(U,!0),W(),j()):requestAnimationFrame(I)}const T=tt(()=>[{label:"FIGHT",color:"rgba(220,89,89,0.8)",action:_()},{label:"BAG",color:"rgba(236,168,89,0.8)",action:d()},{label:"POKEMON",color:"rgba(126,175,83,0.8)",action:B()},{label:"RUN",color:"rgba(89,155,220,0.8)",action:D()}]);function c(l){if(!l)return[{top:42,left:8,rotation:-1},{top:42,left:38,rotation:1},{top:62,left:8,rotation:-1},{top:62,left:38,rotation:1}];const k=window.innerHeight||600,G=window.innerWidth||800,M={x:l.x+l.width/2,y:l.y+l.height/2},R=l.width*.7+60,v=50,u=M.x-R,m=M.x+R-130,w=M.y-v,p=M.y+v-35,P=Math.max(0,u/G*100),H=Math.max(0,m/G*100),K=Math.max(0,w/k*100),oe=Math.max(0,p/k*100);return[{top:K-10,left:P,rotation:-1},{top:K,left:H,rotation:1},{top:oe-10,left:P,rotation:-1},{top:oe,left:H,rotation:1}]}let q=X(ke(c(null)));function W(){const l=ft(x());i(q,c(l),!0)}function j(){const l=O.filter(Boolean);l.length!==0&&(V()?Se.fromTo(l,{scale:.5,opacity:0,x:-60},{scale:1,opacity:1,x:0,duration:.4,delay:b()/1e3,stagger:.1,ease:"back.out(1.4)"}):Se.fromTo(l,{opacity:0,scale:.9},{opacity:1,scale:1,duration:.15,stagger:.03,ease:"power2.out"}))}je(()=>(window.addEventListener("resize",W),()=>{window.removeEventListener("resize",W)})),Te(()=>{i(N,s())}),Te(()=>{x()?(i(U,!1),I()):i(U,!0)}),Te(()=>{F()&&e(U)&&O.length>0&&W()}),Te(()=>{F()&&!t()&&e(U)&&setTimeout(()=>{j()},50)});var re=Ae(),L=ue(re);{var z=l=>{var k=Ae(),G=ue(k);xe(G,17,()=>T,_e,(M,R,v)=>{const u=Y(()=>e(q)[v]||{top:50+v*11,left:18,rotation:0});var m=ya();let w;var p=o(m),P=o(p),H=o(P);Le(m,(K,oe)=>O[oe]=K,K=>O?.[K],()=>[v]),Z(()=>{w=be(m,1,"action-plate svelte-m40kti",null,w,{selected:!t()&&e(N)===v}),ve(m,`
				--action-color: ${e(R).color??""};
				top: ${e(u).top??""}%;
				left: ${e(u).left??""}%;
				--plate-rotation: ${e(u).rotation??""}deg;
				opacity: 0;
			`),m.disabled=t(),ce(m,"aria-label",e(R).label),ne(H,e(R).label)}),ye("click",m,()=>e(R).action()),vt("mouseenter",m,()=>{i(N,v,!0),E()(v)}),g(M,m)}),g(l,k)};J(L,l=>{F()&&!t()&&e(U)&&l(z)})}g(A,re),Fe()}at(["click"]);var ba=C('<button><div class="info-badge svelte-13vhjet" role="button" tabindex="0" aria-label="Move info"><span class="info-badge-text svelte-13vhjet">i</span></div> <div class="card-body svelte-13vhjet"><div class="plate-content svelte-13vhjet"><span class="move-name svelte-13vhjet"> </span></div> <div class="type-watermark svelte-13vhjet"><div class="type-icon svelte-13vhjet"><img class="svelte-13vhjet"/></div></div></div> <div class="pp-tag svelte-13vhjet"><span class="pp-text svelte-13vhjet"> </span></div></button>');function wa(A,n){We(n,!0);const t=te(n,"disabled",3,!1),s=te(n,"selectedMoveIdx",3,0),F=te(n,"show",3,!0),_=te(n,"onMoveClick",3,()=>{}),d=te(n,"onInfoClick",3,()=>{}),B=te(n,"onHover",3,()=>{}),D=te(n,"spriteElement",3,null),E=[];let x=X(ke(tt(()=>s()))),b=X(ke([]));const V={normal:"#A8A878",fire:"#F08030",water:"#6890F0",electric:"#F8D030",grass:"#78C850",ice:"#98D8D8",fighting:"#C03028",poison:"#A040A0",ground:"#E0C068",flying:"#A890F0",psychic:"#F85888",bug:"#A8B820",rock:"#B8A038",ghost:"#705898",dragon:"#7038F8",dark:"#705848",steel:"#B8B8D0",fairy:"#EE99AC"};function O(L){return V[L.toLowerCase()]||"#A8A878"}function N(){const L=ft(D());i(b,ga(L,n.moves.length),!0)}function U(){if(E.length===0)return;const L=E.filter(Boolean);if(L.length===0)return;const z=ft(D()),l=z?0:-100,k=z?0:50;Se.fromTo(L,{scale:.6,opacity:0,x:l,y:k},{scale:1,opacity:1,x:0,y:0,duration:.35,stagger:.1,ease:"back.out(1.2)"})}je(()=>{window.addEventListener("resize",N),N();const L=setTimeout(()=>{F()&&U()},50);return()=>{window.removeEventListener("resize",N),clearTimeout(L)}}),Te(()=>{i(x,s())}),Te(()=>{D()&&N()}),Te(()=>{F()&&E.length>0&&N()});let ee=null,I=!1;function T(L,z){I=!1,ee=setTimeout(()=>{I=!0,d()(z)},500)}function c(L,z){ee&&(clearTimeout(ee),ee=null),I&&(L.preventDefault(),I=!1)}function q(){ee&&(clearTimeout(ee),ee=null),I=!1}var W=Ae(),j=ue(W);{var re=L=>{var z=Ae(),l=ue(z);xe(l,17,()=>n.moves,_e,(k,G,M)=>{const R=Y(()=>e(b)[M]||{top:50+M*12,left:20,rotation:0});var v=ba();let u;var m=o(v),w=y(m,2),p=o(w),P=o(p),H=o(P),K=y(p,2),oe=o(K),Q=o(oe),se=y(w,2),fe=o(se),pe=o(fe);Le(v,(ie,he)=>E[he]=ie,ie=>E?.[ie],()=>[M]),Z((ie,he,Ee)=>{u=be(v,1,"attack-plate svelte-13vhjet",null,u,{selected:e(x)===M,"disabled-move":e(G).pp<=0}),ve(v,`
				--type-color: ${ie??""};
				top: ${e(R).top??""}%;
				left: ${e(R).left??""}%;
				--plate-rotation: ${e(R).rotation??""}deg;
			`),v.disabled=t()||e(G).pp<=0,ne(H,he),ce(Q,"src",`src/assets/types/${Ee??""}-small.png`),ce(Q,"alt",e(G).type),ne(pe,`${e(G).currentPp??""}/${e(G).pp??""}`)},[()=>O(e(G).type),()=>e(G).name.toUpperCase(),()=>e(G).type.toLowerCase()]),ye("click",v,()=>e(G).pp>0&&_()(M)),ye("touchstart",v,ie=>T(ie,M)),ye("touchend",v,ie=>c(ie)),vt("touchcancel",v,()=>q()),vt("mouseenter",v,()=>{e(G).pp>0&&(i(x,M,!0),B()(M))}),ye("click",m,ie=>{ie.stopPropagation(),d()(M)}),ye("keydown",m,ie=>{ie.key==="Enter"&&(ie.stopPropagation(),d()(M))}),g(k,v)}),g(L,z)};J(j,L=>{F()&&L(re)})}g(A,W),Fe()}at(["click","touchstart","touchend","keydown"]);var xa=C('<h3 style="margin: 0; text-transform: uppercase; letter-spacing: 1px; font-size: 1.5rem"> </h3>'),_a=C('<div class="move-info-body svelte-kgwhzz"><div class="badges-row svelte-kgwhzz"><div class="type-badge svelte-kgwhzz"><img class="svelte-kgwhzz"/> <span> </span></div> <div class="category-badge svelte-kgwhzz"><img class="svelte-kgwhzz"/> <span> </span></div></div> <table class="stats-table svelte-kgwhzz"><thead><tr><th class="svelte-kgwhzz">Power</th><th class="svelte-kgwhzz">Acc</th><th class="svelte-kgwhzz">PP</th></tr></thead><tbody><tr><td class="svelte-kgwhzz"> </td><td class="svelte-kgwhzz"> </td><td class="svelte-kgwhzz"> </td></tr></tbody></table> <div class="description-box svelte-kgwhzz"><p class="svelte-kgwhzz"> </p></div></div>');function Aa(A,n){We(n,!0);let t=te(n,"showModal",15);const s={normal:"#A8A878",fire:"#F08030",water:"#6890F0",electric:"#F8D030",grass:"#78C850",ice:"#98D8D8",fighting:"#C03028",poison:"#A040A0",ground:"#E0C068",flying:"#A890F0",psychic:"#F85888",bug:"#A8B820",rock:"#B8A038",ghost:"#705898",dragon:"#7038F8",dark:"#705848",steel:"#B8B8D0",fairy:"#EE99AC"};Wt(A,{get showModal(){return t()},set showModal(_){t(_)},header:_=>{var d=xa(),B=o(d);Z(()=>ne(B,n.move?.name)),g(_,d)},children:(_,d)=>{var B=Ae(),D=ue(B);{var E=x=>{var b=_a(),V=o(b),O=o(V),N=o(O),U=y(N,2),ee=o(U),I=y(O,2),T=o(I),c=y(T,2),q=o(c),W=y(V,2),j=y(o(W)),re=o(j),L=o(re),z=o(L),l=y(L),k=o(l),G=y(l),M=o(G),R=y(W,2),v=o(R),u=o(v);Z((m,w,p)=>{ve(O,`background-color: ${m??""}`),ce(N,"src",`src/assets/types/${w??""}-small.png`),ce(N,"alt",n.move.type),ne(ee,n.move.type),ce(T,"src",`src/assets/moves-cat/${n.move.category??""}.png`),ce(T,"alt",n.move.category),ne(q,n.move.category),ne(z,n.move.power||"-"),ne(k,n.move.accuracy||"-"),ne(M,`${n.move.currentPp??""}/${n.move.pp??""}`),ne(u,p)},[()=>s[n.move.type.toLowerCase()]||"#A8A878",()=>n.move.type.toLowerCase(),()=>n.move.description?.replaceAll("$effect_chance",n.move.effectChance+"")]),g(x,b)};J(D,x=>{n.move&&x(E)})}g(_,B)},$$slots:{header:!0,default:!0}}),Fe()}var Sa=C("<span> </span>"),ka=C('<button role="menuitem"><div class="card-body svelte-1mzhhx"><span class="target-label svelte-1mzhhx"> </span> <!></div></button>'),Ca=C("<span> </span>"),Ia=C('<button role="menuitem"><div class="card-body svelte-1mzhhx"><span class="target-label svelte-1mzhhx"> </span> <!></div></button>'),Ea=C("<!> <!>",1);function Pa(A,n){We(n,!0);const t=te(n,"spriteElement",3,null),s=[],F=[];let _=X(!1);function d(c){return n.selectedMove?.type?n.battleCtx?.calculateTypeEffectiveness(n.selectedMove.type,c.types)??1:1}function B(c){return n.battleCtx.getPokemonSide(c)==="ally"?"ally":"opponent"}function D(c){return B(c)==="ally"?"#4ade80":"#f87171"}const E=Y(()=>n.possibleTargets.filter(c=>B(c)==="ally")),x=Y(()=>n.possibleTargets.filter(c=>B(c)==="opponent"));function b(){if(!t())return!1;const c=t().getBoundingClientRect();return c.x>0||c.y>0}function V(){b()?(i(_,!0),setTimeout(()=>{N(),U()},50)):requestAnimationFrame(V)}function O(c,q){const W=window.innerHeight||600,j=window.innerWidth||800;if(!t()){const k=c==="ally"?5:60;return Array.from({length:q},(G,M)=>({top:45+M*12,left:k}))}const re=t().getBoundingClientRect(),L={x:re.left+re.width/2-100,y:re.top+re.height/2},z=re.width*.7+100,l=c==="ally"?L.x-z:L.x+z-80;return Array.from({length:q},(k,G)=>{const M=L.y-50+G*65;return{top:Math.max(0,M/W*100),left:Math.max(0,l/j*100)}})}function N(){const c=O("ally",e(E).length),q=O("opponent",e(x).length);s.forEach((W,j)=>{W&&c[j]&&(W.style.top=`${c[j].top}%`,W.style.left=`${c[j].left}%`)}),F.forEach((W,j)=>{W&&q[j]&&(W.style.top=`${q[j].top}%`,W.style.left=`${q[j].left}%`)})}function U(){const c=[...s,...F].filter(Boolean);c.length!==0&&Se.fromTo(c,{opacity:0,scale:.7,x:-30},{opacity:1,scale:1,x:0,duration:.4,stagger:.08,ease:"back.out(1.4)"})}je(()=>(window.addEventListener("resize",N),()=>{window.removeEventListener("resize",N)})),Te(()=>{t()&&(i(_,!1),V())}),Te(()=>{n.show&&e(_)&&N()});var ee=Ae(),I=ue(ee);{var T=c=>{var q=Ea(),W=ue(q);xe(W,17,()=>e(E),_e,(re,L,z)=>{var l=ka();let k;var G=o(l),M=o(G),R=o(M),v=y(M,2);{var u=w=>{var p=Sa();let P;var H=o(p);Z((K,oe)=>{P=be(p,1,"effectiveness svelte-1mzhhx",null,P,K),ne(H,`x${oe??""}`)},[()=>({"super-effective":d(e(L))>1,"not-effective":d(e(L))<1}),()=>d(e(L))]),g(w,p)},m=Y(()=>d(e(L))!==1);J(v,w=>{e(m)&&w(u)})}Le(l,(w,p)=>s[p]=w,w=>s?.[w],()=>[z]),Z((w,p,P,H)=>{k=be(l,1,"target-plate ally svelte-1mzhhx",null,k,w),ve(l,`--target-color: ${p??""}`),ce(l,"aria-label",`Target ${e(L).name??""}, ally, effectiveness ${P??""}x`),ne(R,H)},[()=>({selected:n.selectedTargetIdx===n.possibleTargets.indexOf(e(L))}),()=>D(e(L)),()=>d(e(L)),()=>e(L).name.toUpperCase()]),ye("click",l,()=>n.onTargetClick(e(L))),g(re,l)});var j=y(W,2);xe(j,17,()=>e(x),_e,(re,L,z)=>{var l=Ia();let k;var G=o(l),M=o(G),R=o(M),v=y(M,2);{var u=w=>{var p=Ca();let P;var H=o(p);Z((K,oe)=>{P=be(p,1,"effectiveness svelte-1mzhhx",null,P,K),ne(H,`x${oe??""}`)},[()=>({"super-effective":d(e(L))>1,"not-effective":d(e(L))<1}),()=>d(e(L))]),g(w,p)},m=Y(()=>d(e(L))!==1);J(v,w=>{e(m)&&w(u)})}Le(l,(w,p)=>F[p]=w,w=>F?.[w],()=>[z]),Z((w,p,P,H)=>{k=be(l,1,"target-plate opponent svelte-1mzhhx",null,k,w),ve(l,`--target-color: ${p??""}`),ce(l,"aria-label",`Target ${e(L).name??""}, opponent, effectiveness ${P??""}x`),ne(R,H)},[()=>({selected:n.selectedTargetIdx===n.possibleTargets.indexOf(e(L))}),()=>D(e(L)),()=>d(e(L)),()=>e(L).name.toUpperCase()]),ye("click",l,()=>n.onTargetClick(e(L))),g(re,l)}),g(c,q)};J(I,c=>{n.show&&e(_)&&c(T)})}g(A,ee),Fe()}at(["click"]);var qa=C('<div class="battle-info-text svelte-p6req1"> </div>');function Ma(A,n){const t=te(n,"message",3,""),s=te(n,"moveDescription",3,""),F=Y(()=>s()||t());var _=Ae(),d=ue(_);{var B=D=>{var E=qa(),x=o(E);Z(()=>ne(x,e(F))),Mt(3,E,()=>Ut,()=>({duration:150})),g(D,E)};J(d,D=>{e(F)&&D(B)})}g(A,_)}function it(A,n,t=2,s=4){const F=Math.floor(A/t),_=A%t,d=Math.ceil(s/t)-1,B=t-1;let D=F,E=_;switch(n){case"up":D=Math.max(0,F-1);break;case"down":D=Math.min(d,F+1);break;case"left":E=Math.max(0,_-1);break;case"right":E=Math.min(B,_+1);break}const x=D*t+E;return x<s?x:A}var Ta=C('<div class="cancel-wrapper svelte-1ghnl75"><button class="cancel-last button svelte-1ghnl75" aria-label="Cancel last action">Cancel</button></div>'),za=C('<button class="back-plate svelte-1ghnl75" aria-label="Go back to action menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-1ghnl75"><path d="M5.82843 6.99955L8.36396 9.53509L6.94975 10.9493L2 5.99955L6.94975 1.0498L8.36396 2.46402L5.82843 4.99955H13C17.4183 4.99955 21 8.58127 21 12.9996C21 17.4178 17.4183 20.9996 13 20.9996H4V18.9996H13C16.3137 18.9996 19 16.3133 19 12.9996C19 9.68584 16.3137 6.99955 13 6.99955H5.82843Z" class="svelte-1ghnl75"></path></svg> <span class="back-label svelte-1ghnl75">BACK</span></button> <!>',1),La=C('<li class="lvl-stat svelte-1ghnl75"></li>'),Ha=C('<div class="level-up svelte-1ghnl75"><ul class="svelte-1ghnl75"></ul></div>'),Ba=C('<button class="back-mini-pkmn-btn svelte-1ghnl75" aria-label="Go back"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-1ghnl75"><path d="M10.5859 12L2.79297 4.20706L4.20718 2.79285L12.0001 10.5857L19.793 2.79285L21.2072 4.20706L13.4143 12L21.2072 19.7928L19.793 21.2071L12.0001 13.4142L4.20718 21.2071L2.79297 19.7928L10.5859 12Z" class="svelte-1ghnl75"></path></svg></button>'),Oa=C("<!> <!>",1),Ra=C('<button class="back-mini-pkmn-btn svelte-1ghnl75" aria-label="Go back"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-1ghnl75"><path d="M10.5859 12L2.79297 4.20706L4.20718 2.79285L12.0001 10.5857L19.793 2.79285L21.2072 4.20706L13.4143 12L21.2072 19.7928L19.793 21.2071L12.0001 13.4142L4.20718 21.2071L2.79297 19.7928L10.5859 12Z" class="svelte-1ghnl75"></path></svg></button> <!>',1),Da=C("<!> <!> <!> <!> <!> <!>",1),Wa=C("<!> <!>",1);function Fa(A,n){We(n,!0);let t=te(n,"battleCtx",15),s=te(n,"allySprites",19,()=>[]),F=te(n,"entranceDelay",3,0),_=te(n,"isInitialEntrance",3,!0),d=te(n,"visible",3,!0),B=X(ke(t()?.actionIdx??0));const D=Y(()=>s()[e(B)]??s()[0]??null);let E=X(!1),x=X(!1),b=X(ke([])),V=X(ke([])),O=X(!1),N=X(!1),U=X(void 0),ee=X(!1),I=X(void 0),T=X(void 0),c=X(void 0),q=X(!1),W=X(void 0),j=X(!1),re=X(void 0),L=X(!1),z=X(void 0),l=X(!1),k=X(!1);const G=120,M=t().player.comboJauge;let R=X(ke(M.value)),v=X(ke(M.stored)),u=X(!1),m=X(void 0);const w=["total","accuracy","evasion"],p=Y(()=>e(k)?"switch":e(j)?"combo":"change");let P=X(!1);const H=[];t().currentMessage.subscribe(a=>{i(U,a,!0)}),t().isPlayerTurn.subscribe(a=>{i(P,a,!0)}),Te(()=>{i(ee,!e(P)||_(),!0)}),t().events.levelUp.subscribe(a=>{a&&a.newStats&&(H.push(setTimeout(()=>{i(m,a,!0)},500)),H.push(setTimeout(()=>{i(m,void 0)},3500)))}),t().currentAction.subscribe(()=>{t().player.comboJauge.value!=e(R)&&!e(u)&&(i(u,!0),i(N,!0),H.push(setTimeout(()=>{i(N,!1)},4e3)),t().player.comboJauge.value<e(R)&&t().player.comboJauge.stored>=e(v)?(H.push(setTimeout(()=>{i(R,100)},50)),H.push(setTimeout(()=>{i(R,0)},950)),H.push(setTimeout(()=>{i(R,t().player.comboJauge.value,!0),i(v,t().player.comboJauge.stored,!0),i(u,!1)},1900))):(i(R,t().player.comboJauge.value,!0),i(v,t().player.comboJauge.stored,!0),i(u,!1)))});function K(){const a=t().playerSide[t().actionIdx];t()&&a&&t().setPlayerAction(new Bt(a))}function oe(){i(k,!0)}function Q(){i(l,!0)}function se(a,f,h){if(!h&&a!==e(I)){i(I,a,!0);return}let S;const $=t().playerSide[t().actionIdx];if($){if(h&&h.length>0)S=h.map(ae=>e(V)[e(b).indexOf(ae)]);else{const{slots:ae,displayTargets:me,selectOne:Ce}=t().getPossibleTargets($,f);if(Ce){i(x,!0),i(b,me,!0),i(V,ae,!0);return}else S=ae}if(t()&&S){if(e(re)){t().setPlayerAction(new gt(new Et(f,e(re).move,e(re).pokemon),S,$)),i(re,void 0),i(j,!1);return}else t().setPlayerAction(new gt(f,S,$));i(c,void 0),i(I,void 0),i(b,[],!0),i(V,[],!0),i(x,!1),i(E,!1),i(N,!1)}}}function fe(a){i(k,!1);const f=t()?.playerSide[t().actionIdx];f&&t()?.setPlayerAction(new Ot(f,a,t().player))}function pe(a,f){if(t()){const h=t().playerSide.indexOf(f),S=t().player.monsters.indexOf(a);(ae=>{var me=It(ae,2);t(t().player.monsters[h]=me[0],!0),t(t().player.monsters[S]=me[1],!0)})([t().player.monsters[S],t().player.monsters[h]]),t(t().playerSide[h]=t().player.monsters[h],!0);const $=t().playerSide[h];$&&(t().participants.add($),t().currentMessage.set(`What should ${$.name} do?`)),i(L,!1),i(T,0),i(I,0),t().events.pokemonChange.set({side:"ally",idx:h})}}function ie(a,f){i(re,{pokemon:a,move:f},!0),i(O,!0)}function he(a){i(l,!1);const f=n.context.ITEMS.getItem(a.item)?.instanciate();let h=0;a.target&&(h=t()?.playerSide.indexOf(a.target));const S=t()?.playerSide[h];a.target&&t()&&S?f&&f.doesApply(a.target,S,t())?(t()?.setPlayerAction(new yt(a.item,a.target,S,t().player)),n.overWorldCtx.closeMenu(ht.BAG)):alert("This item cannot be used here"):f instanceof ut&&t()&&t().oppSide[0]&&S&&f.doesApply(t().oppSide[0],S,t())?(t()?.setPlayerAction(new yt(a.item,t().oppSide[0],S,t().player)),n.overWorldCtx.closeMenu(ht.BAG)):alert("This item cannot be used here")}const Ee=a=>{if(!t())return;if(e(q)){(a.key==="i"||a.key==="I")&&(a.preventDefault(),i(q,!1));return}if(e(k)||e(L)||e(j)||e(l))if(a.key==="Escape")i(k,!1),i(L,!1),i(j,!1),i(l,!1);else return;const f=t().playerSide[t().actionIdx];if(!n.context.overWorldContext.menus.bagOpened&&!n.context.overWorldContext.menus.switchOpened&&!e(ee)){if(a.key==="ArrowUp"||a.key==="ArrowDown")if(a.preventDefault(),e(E)&&e(x))a.key==="ArrowUp"?e(c)===void 0?i(c,0):i(c,e(c)===0?e(b).length-1:e(c)-1,!0):e(c)===void 0?i(c,0):i(c,e(c)===e(b).length-1?0:e(c)+1,!0);else if(e(E)&&f){const h=a.key==="ArrowUp"?"up":"down",S=it(e(I)??0,h,2,f.moves.length);f.moves[S].pp>0&&i(I,S,!0)}else if(e(T)===void 0)i(T,0);else{const h=a.key==="ArrowUp"?"up":"down";i(T,it(e(T),h,2,4),!0)}else if(a.key==="ArrowLeft"||a.key==="ArrowRight")if(a.preventDefault(),e(E)&&e(x))a.key==="ArrowLeft"?e(c)===void 0?i(c,0):i(c,e(c)===0?e(b).length-1:e(c)-1,!0):e(c)===void 0?i(c,0):i(c,e(c)===e(b).length-1?0:e(c)+1,!0);else if(e(E)&&f){const h=a.key==="ArrowLeft"?"left":"right",S=it(e(I)??0,h,2,f.moves.length);f.moves[S].pp>0&&i(I,S,!0)}else if(e(T)===void 0)i(T,0);else{const h=a.key==="ArrowLeft"?"left":"right";i(T,it(e(T),h,2,4),!0)}else if((a.key==="Enter"||a.key===" ")&&e(I)!==void 0&&f)a.preventDefault(),e(E)&&e(x)&&e(c)!==void 0?se(e(I),f.moves[e(I)],[e(b)[e(c)]]):e(E)?se(e(I),f.moves[e(I)]):e(T)===0?(i(E,!0),i(N,!0),i(O,!0)):e(T)===1?Q():e(T)===2?oe():e(T)===3&&K();else if(a.key==="Escape")!e(E)&&!e(N)&&!e(O)&&!e(x)&&(t().playerTurnActions?.length??0)>0?t().cancelLastAction():(i(x,!1),i(E,!1),i(N,!1),i(O,!1));else if((a.key==="i"||a.key==="I")&&e(E)){a.preventDefault();const h=t().playerSide[t().actionIdx];h&&e(I)!==void 0&&(i(W,h.moves[e(I)],!0),i(q,!0))}}};function Pe(a){const f=t()?.playerSide[t().actionIdx];f&&f.moves[a]&&(i(W,f.moves[a],!0),i(q,!0))}function Je(){return t().player.monsters?.filter(a=>!!a&&!a.fainted)?.length>=(t().battleType===rt.SINGLE?1:2)}je(()=>{window.addEventListener("keydown",Ee);const a=setInterval(()=>{t()?.actionIdx!==e(B)&&i(B,t()?.actionIdx??0,!0)},100);return t().events.playerPokemonFaint.subscribe(f=>{f&&Je()&&(i(L,!0),i(z,f,!0))}),()=>{window.removeEventListener("keydown",Ee),clearInterval(a),H.forEach(clearTimeout)}});var Ve=Wa(),Ge=ue(Ve);{var Re=a=>{var f=Da(),h=ue(f);{var S=le=>{var ge=Ta(),ze=o(ge);ye("click",ze,()=>t().cancelLastAction()),g(le,ge)};J(h,le=>{t()?.playerTurnActions?.length>0&&t()?.playerSide?.length>1&&!e(E)&&!e(x)&&le(S)})}var $=y(h,2);Ma($,{get message(){return e(U)}});var ae=y($,2);{var me=le=>{var ge=za(),ze=ue(ge),Ze=y(ze,2);{var Be=Ne=>{{let nt=Y(()=>t()?.playerSide[t().actionIdx]?.moves||[]);wa(Ne,{show:!0,get moves(){return e(nt)},get disabled(){return e(ee)},get selectedMoveIdx(){return e(I)},get spriteElement(){return e(D)},onMoveClick:Xe=>{const Ke=t()?.playerSide[t().actionIdx]?.moves[Xe];Ke&&se(Xe,Ke)},onCancel:()=>{i(E,!1),i(N,!1)},onHover:Xe=>{i(I,Xe,!0)},onInfoClick:Xe=>Pe(Xe)})}},qe=Ne=>{{let nt=Y(()=>e(I)!==void 0?t()?.playerSide[t().actionIdx]?.moves[e(I)]:void 0);Pa(Ne,{get possibleTargets(){return e(b)},get selectedTargetIdx(){return e(c)},get selectedMove(){return e(nt)},get battleCtx(){return t()},show:!0,get spriteElement(){return e(D)},onTargetClick:Xe=>{const Ke=e(b).indexOf(Xe),et=e(I)!==void 0?t()?.playerSide[t().actionIdx]?.moves[e(I)]:void 0;et&&se(Ke,et,[Xe])}})}};J(Ze,Ne=>{e(x)?Ne(qe,!1):Ne(Be)})}ye("click",ze,()=>{i(E,!1),i(N,!1),i(x,!1)}),g(le,ge)},Ce=le=>{ha(le,{show:!0,get disabled(){return e(ee)},get selectedOptionIdx(){return e(T)},get spriteElement(){return e(D)},get entranceDelay(){return F()},get isInitialEntrance(){return _()},onFight:()=>{i(E,!0),i(O,!0),i(N,!0)},onBag:()=>Q(),onSwitch:()=>oe(),onRun:()=>K(),onHover:ge=>{i(T,ge,!0)}})};J(ae,le=>{e(E)&&!e(ee)?le(me):le(Ce,!1)})}var Ie=y(ae,2);{var Ye=le=>{var ge=Ha(),ze=o(ge);xe(ze,21,()=>Object.keys(e(m).oldStats),_e,(Ze,Be)=>{var qe=Ae(),Ne=ue(qe);{var nt=Ke=>{var et=La();Z(qt=>{ce(et,"data-stat",qt),ce(et,"data-val1",`${e(m).oldStats[e(Be)]??""} + ${e(m).newStats[e(Be)]-e(m).oldStats[e(Be)]}`),ce(et,"data-val2",e(m).newStats[e(Be)])},[()=>e(Be).replace(/attack/i,"atk").replace(/defense/i,"def").replace("special","sp.").toUpperCase()]),g(Ke,et)},Xe=Y(()=>!w.includes(e(Be)));J(Ne,Ke=>{e(Xe)&&Ke(nt)})}g(Ze,qe)}),g(le,ge)};J(Ie,le=>{e(m)&&e(m).oldStats&&e(m).newStats&&le(Ye)})}var Ue=y(Ie,2);{var de=le=>{var ge=Oa(),ze=ue(ge);{var Ze=qe=>{var Ne=Ba();ye("click",Ne,()=>{i(k,!1),i(j,!1)}),g(qe,Ne)};J(ze,qe=>{(e(k)||e(j))&&qe(Ze)})}var Be=y(ze,2);la(Be,{get context(){return n.context},get currentPkmn(){return t().playerSide[t().actionIdx]},get type(){return e(p)},zIndex:G,onCombo:qe=>{qe&&ie(qe.pokemon,qe.move),i(j,!1)},onChange:qe=>{qe&&e(k)?fe(qe):qe&&e(L)&&e(z)&&(pe(qe,e(z)),i(z,void 0))}}),g(le,ge)};J(Ue,le=>{(e(k)||e(L)||e(j))&&le(de)})}var we=y(Ue,2);{var He=le=>{var ge=Ra(),ze=ue(ge),Ze=y(ze,2);ma(Ze,{get context(){return n.context},get currentPkmn(){return t().playerSide[t().actionIdx]},get battleCtx(){return t()},zIndex:G,onChange:Be=>he(Be)}),ye("click",ze,()=>{i(l,!1)}),g(le,ge)};J(we,le=>{e(l)&&le(He)})}g(a,f)};J(Ge,a=>{d()&&a(Re)})}var r=y(Ge,2);Aa(r,{get move(){return e(W)},get showModal(){return e(q)},set showModal(a){i(q,a,!0)}}),g(A,Ve),Fe()}at(["click"]);var Ga=C('<span class="gender-symbol spatial-text svelte-ds5pwd"> </span>'),Ya=C('<span class="hp-value svelte-ds5pwd"> </span>'),Na=C('<div class="exp-bar-container svelte-ds5pwd"><div class="exp-bar-bg svelte-ds5pwd"><div class="exp-bar-fill svelte-ds5pwd"></div></div></div>'),Xa=C('<div><span class="spatial-text ability-text svelte-ds5pwd"> </span></div>'),Ua=C('<span><span class="spatial-text svelte-ds5pwd"> </span></span>'),Ja=C('<div class="stat-changes svelte-ds5pwd"></div>'),Va=C('<div class="status-chip svelte-ds5pwd"><span class="spatial-text svelte-ds5pwd"> </span></div>'),Za=C('<div class="floating-pokemon-info spatial-panel svelte-ds5pwd"><div class="info-header svelte-ds5pwd"><span class="pokemon-name spatial-text svelte-ds5pwd"> <!></span> <span class="level-text spatial-text svelte-ds5pwd"> </span></div> <div class="hp-bar-container"><div class="hp-bar-bg svelte-ds5pwd"><div class="hp-bar-fill svelte-ds5pwd"><!></div></div></div> <!> <div class="leader-line svelte-ds5pwd"></div> <div class="below-box-indicators svelte-ds5pwd"><!> <!> <!></div></div>');function ot(A,n){We(n,!0);const t=te(n,"position",19,()=>({bottom:"62%",left:"22%"})),s=te(n,"isAlly",3,!0),F=te(n,"showExpBar",3,!1),_=te(n,"expPercent",3,0),d=te(n,"spriteElement",3,null),B=te(n,"visible",3,!0),D=te(n,"entranceDelay",3,0),E=te(n,"side",3,"ally"),x=te(n,"index",3,0);let b=X(void 0);function V(){e(b)&&Se.fromTo(e(b),{opacity:0,y:-20,scale:.9},{opacity:1,y:0,scale:1,duration:.3,delay:D()/1e3,ease:"power2.out"})}let O=X(0);const N=Y(()=>(e(O)>=0,n.pokemon.name)),U=Y(()=>(e(O)>=0,n.pokemon.level)),ee=Y(()=>(e(O)>=0,n.pokemon.currentHp)),I=Y(()=>(e(O)>=0,n.pokemon.currentStats.hp)),T=Y(()=>(e(O)>=0,n.pokemon.gender||"unknown")),c=Y(()=>e(O)>=0&&n.pokemon.status?.abr||null);let q=X(null);Te(()=>Rt.subscribe(se=>{const fe=se.find(pe=>pe.side===E()&&pe.index===x());i(q,fe??null,!0)}));const W={attack:"ATK",defense:"DEF",specialAttack:"SP.A",specialDefense:"SP.D",speed:"SPD"},j=Y(()=>{if(e(O)<0)return[];const Q=[];if(n.pokemon.statsChanges)for(const[se,fe]of Object.entries(n.pokemon.statsChanges))W[se]&&fe!==0&&Q.push({stat:W[se],stages:fe});return Q});let re,L=X(ke(tt(()=>n.pokemon.currentHp)));je(()=>{let Q=n.pokemon.name,se=n.pokemon.status?.abr,fe=JSON.stringify(n.pokemon.statsChanges||{});return re=setInterval(()=>{const pe=n.pokemon.name,ie=n.pokemon.status?.abr,he=JSON.stringify(n.pokemon.statsChanges||{});(pe!==Q||n.pokemon.currentHp!==e(L)||ie!==se||he!==fe)&&(Q=pe,i(L,n.pokemon.currentHp,!0),se=ie,fe=he,Tt(O))},100),()=>{clearInterval(re)}});let z=X(""),l=X(!1),k=X(!1);function G(){if(!d()||d()instanceof HTMLImageElement&&(!d().complete||d().naturalWidth===0))return!1;const Q=d().getBoundingClientRect(),se=window.getComputedStyle(d());if(parseFloat(se.opacity)<.5)return!1;if(d()instanceof HTMLImageElement&&d().naturalWidth>0&&parseFloat(se.width)>0){const ie=parseFloat(se.height),he=d().naturalWidth/d().naturalHeight,Ee=ie*he;if(Q.width<Ee*.9)return!1}return(Q.x>0||Q.y>0)&&Q.width>0&&Q.height>0}function M(){G()?(i(k,!0),R(),setTimeout(()=>V(),50)):requestAnimationFrame(M)}function R(){if(!d()||!e(b))return;const pe=d().closest(".battle");if(!pe)return;const ie=d().getBoundingClientRect(),he=pe.getBoundingClientRect(),Ee=ie.top-he.top-80-16;let Pe=ie.left-he.left+ie.width/2-180/2;const Je=s()?"ally-pokemon-info":"opponent-pokemon-info",Ve=pe.querySelectorAll(`.floating-pokemon-info[data-testid="${Je}"]`);for(const Ge of Ve){if(Ge===e(b))continue;const Re=Ge.getBoundingClientRect();if(Re.width===0)continue;const r=Re.left-he.left,a=Re.top-he.top,f=Pe<r+Re.width&&Pe+180>r,h=Ee<a+Re.height&&Ee+80>a;f&&h&&x()>0&&(s()?Pe=r-180-5:Pe=r+Re.width+5)}Pe=Math.max(20,Math.min(Pe,he.width-180-20)),i(z,`top: ${Ee}px; left: ${Pe}px;`),i(l,!0)}je(()=>{d()&&M(),window.addEventListener("resize",R);let Q=null;d()&&(Q=new ResizeObserver(R),Q.observe(d()));function se(){document.visibilityState==="visible"&&e(b)&&e(k)&&Se.set(e(b),{opacity:1,y:0,scale:1})}return document.addEventListener("visibilitychange",se),()=>{window.removeEventListener("resize",R),Q?.disconnect(),document.removeEventListener("visibilitychange",se)}}),Te(()=>{d()&&(i(k,!1),M())});const v=Y(()=>e(ee)/e(I)*100),u=Y(()=>()=>e(v)>50?"#4ade80":e(v)>20?"#facc15":"#ef4444"),m=Y(()=>()=>{const Q=e(u)();return`linear-gradient(90deg, ${e(v)>50?"#22c55e":e(v)>20?"#eab308":"#dc2626"} 0%, ${Q} 100%)`}),w=Y(()=>()=>e(T)==="male"?"♂":e(T)==="female"?"♀":""),p=Y(()=>()=>e(T)==="male"?"#60a5fa":e(T)==="female"?"#f472b6":"transparent");function P(Q){return{PSN:"#A040A0",TOX:"#700070",BRN:"#F08030",PAR:"#F8D030",SLP:"#A8A8A8",FRZ:"#98D8D8"}[Q]||"#666666"}var H=Ae(),K=ue(H);{var oe=Q=>{var se=Za(),fe=o(se),pe=o(fe),ie=o(pe),he=y(ie);{var Ee=de=>{var we=Ga(),He=o(we);Z((le,ge)=>{ve(we,`color: ${le??""}`),ne(He,ge)},[()=>e(p)(),()=>e(w)()]),g(de,we)},Pe=Y(()=>e(w)());J(he,de=>{e(Pe)&&de(Ee)})}var Je=y(pe,2),Ve=o(Je),Ge=y(fe,2),Re=o(Ge),r=o(Re),a=o(r);{var f=de=>{var we=Ya(),He=o(we);Z(()=>ne(He,`${e(ee)??""} / ${e(I)??""}`)),g(de,we)};J(a,de=>{s()&&de(f)})}var h=y(Ge,2);{var S=de=>{var we=Na(),He=o(we),le=o(He);Z(()=>ve(le,`width: ${_()??""}%`)),g(de,we)};J(h,de=>{F()&&s()&&de(S)})}var $=y(h,4),ae=o($);{var me=de=>{var we=Xa();let He;var le=o(we),ge=o(le);Z(()=>{He=be(we,1,"ability-chip svelte-ds5pwd",null,He,{ally:E()==="ally",opponent:E()==="opponent"}),ne(ge,e(q).abilityName)}),g(de,we)};J(ae,de=>{e(q)&&de(me)})}var Ce=y(ae,2);{var Ie=de=>{var we=Ja();xe(we,21,()=>e(j),_e,(He,le)=>{var ge=Ua();let ze;var Ze=o(ge),Be=o(Ze);Z(()=>{ze=be(ge,1,"stat-change svelte-ds5pwd",null,ze,{positive:e(le).stages>0,negative:e(le).stages<0}),ne(Be,`${e(le).stat??""}
								${e(le).stages>0?"+":""}${e(le).stages??""}`)}),g(He,ge)}),g(de,we)};J(Ce,de=>{e(j)&&e(j).length>0&&de(Ie)})}var Ye=y(Ce,2);{var Ue=de=>{var we=Va(),He=o(we),le=o(He);Z(ge=>{ve(we,`background-color: ${ge??""}`),ne(le,e(c))},[()=>P(e(c))]),g(de,we)};J(Ye,de=>{e(c)&&de(Ue)})}Le(se,de=>i(b,de),()=>e(b)),Z(de=>{ce(se,"data-testid",s()?"ally-pokemon-info":"opponent-pokemon-info"),ve(se,`${(e(l)?e(z):`bottom: ${t().bottom}; left: ${t().left};`)??""} opacity: 0;`),ne(ie,`${e(N)??""} `),ne(Ve,`Lv.${e(U)??""}`),ce(Ge,"data-testid",s()?"ally-hp-bar":"opponent-hp-bar"),ve(r,`width: ${e(v)??""}%; background: ${de??""}`)},[()=>e(m)()]),g(Q,se)};J(K,Q=>{B()&&(!d()||e(k))&&Q(oe)})}g(A,H),Fe()}var ja=C('<div class="raindrop svelte-1tvzegy"></div>'),Ka=C("<div></div>"),Qa=C("<div></div> <div></div>",1),$a=C('<div class="sand-particle svelte-1tvzegy"></div>'),en=C("<div></div>"),tn=C('<div class="hailstone svelte-1tvzegy"></div>'),an=C("<div></div>"),nn=C('<div><!> <!> <!> <!> <div class="weather-label svelte-1tvzegy"><span class="name svelte-1tvzegy"> </span> <span class="turns svelte-1tvzegy"> </span></div></div>');function sn(A,n){We(n,!0);const t=te(n,"flash",3,!1),s=te(n,"intensify",3,!1),F={[Me.NONE]:"",[Me.RAIN]:"Rain",[Me.SUN]:"Harsh Sunlight",[Me.SAND]:"Sandstorm",[Me.HAIL]:"Hail",[Me.STRONG_WINDS]:"Strong Winds"};let _=0,d=!1;Te(()=>{s()&&!d&&_++,d=s()});const B=Y(()=>_);var D=Ae(),E=ue(D);{var x=b=>{var V=nn();let O;var N=o(V);{var U=k=>{var G=Ae(),M=ue(G);$e(M,()=>e(B),R=>{var v=Ka();let u;xe(v,21,()=>Array(s()?50:30),_e,(m,w)=>{var p=ja();ve(p,`--delay: ${Math.random()*2}s; --x: ${Math.random()*100}%; --duration: ${.5+Math.random()*.5}s`),g(m,p)}),Z(()=>u=be(v,1,"rain-container svelte-1tvzegy",null,u,{intensify:s()})),g(R,v)}),g(k,G)};J(N,k=>{n.weather===Me.RAIN&&k(U)})}var ee=y(N,2);{var I=k=>{var G=Ae(),M=ue(G);$e(M,()=>e(B),R=>{var v=Qa(),u=ue(v);let m;var w=y(u,2);let p;Z(()=>{m=be(u,1,"sun-rays svelte-1tvzegy",null,m,{intensify:s()}),p=be(w,1,"sun-glow svelte-1tvzegy",null,p,{intensify:s()})}),g(R,v)}),g(k,G)};J(ee,k=>{n.weather===Me.SUN&&k(I)})}var T=y(ee,2);{var c=k=>{var G=Ae(),M=ue(G);$e(M,()=>e(B),R=>{var v=en();let u;xe(v,21,()=>Array(s()?60:40),_e,(m,w)=>{var p=$a();ve(p,`--delay: ${Math.random()*3}s; --x: ${Math.random()*100}%; --y: ${Math.random()*100}%; --size: ${2+Math.random()*4}px`),g(m,p)}),Z(()=>u=be(v,1,"sand-particles svelte-1tvzegy",null,u,{intensify:s()})),g(R,v)}),g(k,G)};J(T,k=>{n.weather===Me.SAND&&k(c)})}var q=y(T,2);{var W=k=>{var G=Ae(),M=ue(G);$e(M,()=>e(B),R=>{var v=an();let u;xe(v,21,()=>Array(s()?35:20),_e,(m,w)=>{var p=tn();ve(p,`--delay: ${Math.random()*2}s; --x: ${Math.random()*100}%; --duration: ${.8+Math.random()*.4}s; --size: ${4+Math.random()*6}px`),g(m,p)}),Z(()=>u=be(v,1,"hail-container svelte-1tvzegy",null,u,{intensify:s()})),g(R,v)}),g(k,G)};J(q,k=>{n.weather===Me.HAIL&&k(W)})}var j=y(q,2),re=o(j),L=o(re),z=y(re,2),l=o(z);Z(()=>{O=be(V,1,"weather-overlay svelte-1tvzegy",null,O,{rain:n.weather===Me.RAIN,sun:n.weather===Me.SUN,sand:n.weather===Me.SAND,hail:n.weather===Me.HAIL,flash:t(),intensify:s()}),ne(L,F[n.weather]),ne(l,n.weatherTurns)}),g(b,V)};J(E,b=>{n.weather!==Me.NONE&&b(x)})}g(A,D),Fe()}var rn=C('<img alt="Stealth Rock" class="hazard-sprite rock svelte-fn96bk"/>'),on=C('<div class="hazard-group ally stealth-rock svelte-fn96bk"></div>'),ln=C('<img alt="Spikes" class="hazard-sprite caltrop svelte-fn96bk"/>'),cn=C('<div class="hazard-group ally spikes svelte-fn96bk"></div>'),dn=C('<img alt="Toxic Spikes" class="hazard-sprite poison-caltrop svelte-fn96bk"/>'),vn=C('<div class="hazard-group ally toxic-spikes svelte-fn96bk"></div>'),un=C('<img alt="Sticky Web" class="hazard-sprite web svelte-fn96bk"/>'),fn=C('<div class="hazard-group ally sticky-web svelte-fn96bk"></div>'),pn=C('<img alt="Stealth Rock" class="hazard-sprite rock svelte-fn96bk"/>'),mn=C('<div class="hazard-group enemy stealth-rock svelte-fn96bk"></div>'),gn=C('<img alt="Spikes" class="hazard-sprite caltrop svelte-fn96bk"/>'),yn=C('<div class="hazard-group enemy spikes svelte-fn96bk"></div>'),hn=C('<img alt="Toxic Spikes" class="hazard-sprite poison-caltrop svelte-fn96bk"/>'),bn=C('<div class="hazard-group enemy toxic-spikes svelte-fn96bk"></div>'),wn=C('<img alt="Sticky Web" class="hazard-sprite web svelte-fn96bk"/>'),xn=C('<div class="hazard-group enemy sticky-web svelte-fn96bk"></div>'),_n=C('<div class="hazard-sprites svelte-fn96bk"><!> <!> <!> <!> <!> <!> <!> <!></div>');function An(A,n){We(n,!0);const t=()=>Lt(n.hazardsVersion,"$hazardsVersion",s),[s,F]=zt();function _(u,m,w){return u.hazards.get(m)||0}function d(u,m){const w=[],p=m?18:58,P=40,H=m?70:65;for(let K=0;K<u;K++)w.push({x:p+Math.random()*P,y:H+Math.random()*5,delay:K*.1});return w}var B=_n(),D=o(B);{var E=u=>{var m=on();xe(m,21,()=>d(5,!0),_e,(w,p)=>{var P=rn();Z(()=>{ce(P,"src",xt),ve(P,`left: ${e(p).x??""}%; top: ${e(p).y??""}%; animation-delay: ${e(p).delay??""}s`)}),g(w,P)}),g(u,m)},x=Y(()=>_(n.allySide,De.STEALTH_ROCK,t())>0);J(D,u=>{e(x)&&u(E)})}var b=y(D,2);{var V=u=>{const m=Y(()=>_(n.allySide,De.SPIKES,t()));var w=cn();xe(w,21,()=>d(e(m)*2,!0),_e,(p,P)=>{var H=ln();Z(()=>{ce(H,"src",_t),ve(H,`left: ${e(P).x??""}%; top: ${e(P).y??""}%; animation-delay: ${e(P).delay??""}s`)}),g(p,H)}),g(u,w)},O=Y(()=>_(n.allySide,De.SPIKES,t())>0);J(b,u=>{e(O)&&u(V)})}var N=y(b,2);{var U=u=>{const m=Y(()=>_(n.allySide,De.TOXIC_SPIKES,t()));var w=vn();xe(w,21,()=>d(e(m)*2,!0),_e,(p,P)=>{var H=dn();Z(()=>{ce(H,"src",At),ve(H,`left: ${e(P).x??""}%; top: ${e(P).y??""}%; animation-delay: ${e(P).delay??""}s`)}),g(p,H)}),g(u,w)},ee=Y(()=>_(n.allySide,De.TOXIC_SPIKES,t())>0);J(N,u=>{e(ee)&&u(U)})}var I=y(N,2);{var T=u=>{var m=fn();xe(m,21,()=>d(1,!0),_e,(w,p)=>{var P=un();Z(()=>{ce(P,"src",St),ve(P,`left: ${e(p).x??""}%; top: ${e(p).y??""}%; animation-delay: ${e(p).delay??""}s`)}),g(w,P)}),g(u,m)},c=Y(()=>_(n.allySide,De.STICKY_WEB,t())>0);J(I,u=>{e(c)&&u(T)})}var q=y(I,2);{var W=u=>{var m=mn();xe(m,21,()=>d(3,!1),_e,(w,p)=>{var P=pn();Z(()=>{ce(P,"src",xt),ve(P,`left: ${e(p).x??""}%; top: ${e(p).y??""}%; animation-delay: ${e(p).delay??""}s`)}),g(w,P)}),g(u,m)},j=Y(()=>_(n.enemySide,De.STEALTH_ROCK,t())>0);J(q,u=>{e(j)&&u(W)})}var re=y(q,2);{var L=u=>{const m=Y(()=>_(n.enemySide,De.SPIKES,t()));var w=yn();xe(w,21,()=>d(e(m)*2,!1),_e,(p,P)=>{var H=gn();Z(()=>{ce(H,"src",_t),ve(H,`left: ${e(P).x??""}%; top: ${e(P).y??""}%; animation-delay: ${e(P).delay??""}s`)}),g(p,H)}),g(u,w)},z=Y(()=>_(n.enemySide,De.SPIKES,t())>0);J(re,u=>{e(z)&&u(L)})}var l=y(re,2);{var k=u=>{const m=Y(()=>_(n.enemySide,De.TOXIC_SPIKES,t()));var w=bn();xe(w,21,()=>d(e(m)*2,!1),_e,(p,P)=>{var H=hn();Z(()=>{ce(H,"src",At),ve(H,`left: ${e(P).x??""}%; top: ${e(P).y??""}%; animation-delay: ${e(P).delay??""}s`)}),g(p,H)}),g(u,w)},G=Y(()=>_(n.enemySide,De.TOXIC_SPIKES,t())>0);J(l,u=>{e(G)&&u(k)})}var M=y(l,2);{var R=u=>{var m=xn();xe(m,21,()=>d(1,!1),_e,(w,p)=>{var P=wn();Z(()=>{ce(P,"src",St),ve(P,`left: ${e(p).x??""}%; top: ${e(p).y??""}%; animation-delay: ${e(p).delay??""}s`)}),g(w,P)}),g(u,m)},v=Y(()=>_(n.enemySide,De.STICKY_WEB,t())>0);J(M,u=>{e(v)&&u(R)})}g(A,B),Fe(),F()}var Sn=C('<div class="barrier ally reflect svelte-v1mmwp"><div class="barrier-glow svelte-v1mmwp"></div> <span class="turns svelte-v1mmwp"> </span></div>'),kn=C('<div class="barrier ally light-screen svelte-v1mmwp"><div class="barrier-glow svelte-v1mmwp"></div> <span class="turns svelte-v1mmwp"> </span></div>'),Cn=C('<div class="barrier enemy reflect svelte-v1mmwp"><div class="barrier-glow svelte-v1mmwp"></div> <span class="turns svelte-v1mmwp"> </span></div>'),In=C('<div class="barrier enemy light-screen svelte-v1mmwp"><div class="barrier-glow svelte-v1mmwp"></div> <span class="turns svelte-v1mmwp"> </span></div>'),En=C('<div class="screen-barriers svelte-v1mmwp"><!> <!> <!> <!></div>');function Pn(A,n){We(n,!0);function t(I,T){return(I.screens.get(T)||0)>0}function s(I,T){return I.screens.get(T)||0}var F=En(),_=o(F);{var d=I=>{var T=Sn(),c=y(o(T),2),q=o(c);Z(W=>ne(q,W),[()=>s(n.allySide,Qe.REFLECT)]),g(I,T)},B=Y(()=>t(n.allySide,Qe.REFLECT));J(_,I=>{e(B)&&I(d)})}var D=y(_,2);{var E=I=>{var T=kn(),c=y(o(T),2),q=o(c);Z(W=>ne(q,W),[()=>s(n.allySide,Qe.LIGHT_SCREEN)]),g(I,T)},x=Y(()=>t(n.allySide,Qe.LIGHT_SCREEN));J(D,I=>{e(x)&&I(E)})}var b=y(D,2);{var V=I=>{var T=Cn(),c=y(o(T),2),q=o(c);Z(W=>ne(q,W),[()=>s(n.enemySide,Qe.REFLECT)]),g(I,T)},O=Y(()=>t(n.enemySide,Qe.REFLECT));J(b,I=>{e(O)&&I(V)})}var N=y(b,2);{var U=I=>{var T=In(),c=y(o(T),2),q=o(c);Z(W=>ne(q,W),[()=>s(n.enemySide,Qe.LIGHT_SCREEN)]),g(I,T)},ee=Y(()=>t(n.enemySide,Qe.LIGHT_SCREEN));J(N,I=>{e(ee)&&I(U)})}g(A,F),Fe()}function qn(A){Jt(A),Vt(A),Zt(A),jt(A)}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABsGlDQ1BJQ0MgUHJvZmlsZQAAKJF9kT9IG3EUxz9GRSlRBx0qdLhBxcGIRIeOSRxEUAhpFLUdendJLi3J+eMSKYKj0FVoobRLqx1cHARB3XRwFQKF/gFxLEWcFIVS5Hy/nCXRYh883ofvvfd+796D0K6pVKEpBkW37KXGEsbM7JzR8osQbbTTD6ZdUvFkcgKxv/G2XX6lQccvEd2rsrFXaZ/87Zy87PrZPb318d/8W9aWyZZsaDCEY7byysLPhZOvykrzpnCXJ0MJH2h2Av6u2Qr4tJqTTo0iY4sZdt7MCOueA3beKwrruXsyxYzWVcCu5rearbpap46LhQX7Zk79h+GsO/VE54s/YoxxJkliYLHACwqUiUh0RSmRku+Je+pHqvWjzKNYxJMah7xUG8RFUdIpKzwunWwGGRCOMiQ+om9zd+c1bf4TPL6AxpWaZr2Dndfw8EdN65GbdCzD9oEyPbMqNYqHcjk4W5eTzEJnBR48LeWGo8H04QQ0H/v+eS+0vIGrFd//s+r7V2tSfAT7brDnm158/gbpJZg4hPcfoM+RN5/ds4/W6j7+v7PW+p1fA+h6gKzVZW5aAAAARGVYSWZNTQAqAAAACAACARIAAwAAAAEAAQAAh2kABAAAAAEAAAAmAAAAAAACoAIABAAAAAEAAAAYoAMABAAAAAEAAAAYAAAAAChF4AMAAAICaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4yNDwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4yNDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgqtT/4JAAABT0lEQVRIDe2UoU7EQBCGFwKShOREHwSJxICoQJ7oE2AQfYwKDE9QgURUoJAkGN4BW3HJJUgE5Nvw3+1uZ7d1mJuknenMP/8/s2nr3MH++wSOlgxQ1/VPihuGYVFvESTifjWk/K7Z1D43J5QVgNwiTpUQKokcpw0878gfts5xFezu69vjc5CJwI4812HkSyInBn6fuj/fx0b0/nltZONUtAHTM80SS8lzW0QCIk6blcdTK9VDLPHkiB7PTh3T6DVUw9xm9FlmbiBw3/fu4vLK9ymXkpDP1cBONoDw4+3VQY6tb2+8J5cjogdc27YeG94igb8Pxv8WxnF0VVWF2EksYgqQWx9cJCCGrut8A/7p+cVvFJIJJ18axPxV8LpKBJIcuYibpjGnp9cUoCARYsuWkNOXFaCICJ5tZCExOevchcUXBQSUkJ7xc8Qh9hAXT+AXcYiBq/Gr/YEAAAAASUVORK5CYII=";let Oe=null;function Mn(A){return Oe&&Oe.cancelAll(),Oe=new Kt(A),qn(Oe),Oe.initialize(),Oe}function Tn(){return Oe}function zn(){Oe&&(Oe.cancelAll(),Oe=null)}function st(A,n,t=0,s=!1,F=!1,_=!1){const d=Se.timeline();if(_){Se.set(A,{scale:1,filter:"brightness(0)",opacity:1});const q=s?0:t*.3;return d.to(A,{duration:1.5,delay:q,filter:"brightness(1)",ease:"power2.inOut"},0),new Promise(W=>{d.eventCallback("onComplete",()=>{Se.set(A,{scale:1,filter:"brightness(1)",opacity:1,clearProps:"filter"}),W(d)})})}const B=A.getBoundingClientRect(),D=B.left+B.width/2,E=B.top+B.height/2,x=n==="ally",b=x?-50:window.innerWidth+50,V=window.innerHeight*(x?.7:.3),O=document.createElement("img");O.src=Pt,O.style.cssText=`
		position: fixed;
		width: 40px;
		height: 40px;
		z-index: 100;
		pointer-events: none;
		image-rendering: pixelated;
		left: ${b}px;
		top: ${V}px;
		transform-origin: center center;
	`,document.body.appendChild(O),Se.set(A,{scale:0,filter:"brightness(10)",opacity:0});const N=D-20,U=E,ee=Math.min(150,Math.abs(N-b)*.3),I=Math.min(V,U)-ee,T=s?0:t*.3,c={t:0};return d.to(c,{t:1,duration:.6,delay:T,ease:"power1.out",onUpdate:()=>{const q=c.t,W=(1-q)*(1-q)*b+2*(1-q)*q*((b+N)/2)+q*q*N,j=(1-q)*(1-q)*V+2*(1-q)*q*I+q*q*U;O.style.left=`${W}px`,O.style.top=`${j}px`,O.style.transform=`rotate(${q*(x?720:-720)}deg)`}},0).to(O,{duration:.15,scale:1.5,filter:"brightness(3)",ease:"power2.out"},">-0.1").to(O,{duration:.2,scale:0,opacity:0,ease:"power2.in",onComplete:()=>{O.remove()}},">").to(A,{duration:.1,opacity:1,scale:.1},"<-0.15").to(A,{duration:.4,scale:1,ease:"back.out(1.4)"},">").to(A,{duration:.3,filter:"brightness(1)",ease:"power2.out"},"<+0.1"),new Promise(q=>{d.eventCallback("onComplete",()=>{Se.set(A,{scale:1,filter:"brightness(1)",opacity:1,clearProps:"filter"}),q(d)})})}function kt(A){return Se.timeline().to(A,{filter:"brightness(0)",y:window.innerHeight,duration:1,delay:2}).play()}function ct(A,n,t=0,s){const F=Se.timeline();if(F.to(A,{filter:"brightness(5)",scale:.1,transformOrigin:"center center",duration:.8,delay:.3}).to(A,{x:n==="ally"?-window.innerWidth/2:window.innerWidth/2,duration:1,delay:0},">"),s){const _=s.querySelector(`.${n}-shadow[data-idx="${t}"]`);_&&F.to(_,{opacity:0,duration:.8},.3);const B=(s.parentElement||s).querySelectorAll(`[data-testid="${n}-pokemon-info"]`);B[t]&&F.to(B[t],{opacity:0,duration:.8},.3)}return F.play()}function dt(A,n,t=0,s){const F=Se.timeline(),_=A.getBoundingClientRect(),d=_.left+_.width/2,B=_.top+_.height/2,D=n==="ally",E=D?-50:window.innerWidth+50,x=window.innerHeight*(D?.7:.3);F.to(A,{filter:"brightness(5)",scale:.1,transformOrigin:"center center",duration:.4,ease:"power2.in"}),F.to(A,{opacity:0,duration:.1},">");const b=document.createElement("img");b.src=Pt,b.style.cssText=`
		position: fixed;
		width: 40px;
		height: 40px;
		z-index: 100;
		pointer-events: none;
		image-rendering: pixelated;
		left: ${d-20}px;
		top: ${B}px;
		transform-origin: center center;
		transform: scale(0);
		opacity: 0;
	`,F.call(()=>{document.body.appendChild(b)},[],"<"),F.to(b,{scale:1,opacity:1,filter:"brightness(3)",duration:.15,ease:"power2.out"},">"),F.to(b,{filter:"brightness(1)",duration:.1,ease:"power2.out"},">");const V=d-20,O=B,N=E,U=x,ee=Math.min(150,Math.abs(N-V)*.3),I=Math.min(O,U)-ee,T={t:0};if(F.to(T,{t:1,duration:.6,ease:"power1.in",onUpdate:()=>{const c=T.t,q=(1-c)*(1-c)*V+2*(1-c)*c*((V+N)/2)+c*c*N,W=(1-c)*(1-c)*O+2*(1-c)*c*I+c*c*U;b.style.left=`${q}px`,b.style.top=`${W}px`,b.style.transform=`rotate(${c*(D?-720:720)}deg)`},onComplete:()=>{b.remove()}},">"),s){const c=s.querySelector(`.${n}-shadow[data-idx="${t}"]`);c&&F.to(c,{opacity:0,duration:.6},0);const W=(s.parentElement||s).querySelectorAll(`[data-testid="${n}-pokemon-info"]`);W[t]&&F.to(W[t],{opacity:0,duration:.6},0)}return new Promise(c=>{F.eventCallback("onComplete",()=>{c()}),F.play()})}async function Ct(A){if(!Oe){console.warn("Animation engine not initialized");return}const n={slot:A.initiatorSlot,element:A.initiator,homePosition:Oe.getPosition(A.initiatorSlot)},t={slot:A.targetSlot,element:A.target,homePosition:Oe.getPosition(A.targetSlot)},s={attacker:n,defender:t,moveName:A.moveName,moveCategory:A.moveCategory,moveType:A.moveType,hitCount:A.hitCount};await Oe.playMove(s)}const Ln=""+new URL("beaches-BjR8MuKc.png",import.meta.url).href;var Hn=C("<!> <!>",1),Bn=C('<div class="battle svelte-11c1mlk" data-testid="battle-screen"><div class="wrapper svelte-11c1mlk"><div class="battle-bg svelte-11c1mlk"></div> <!> <!> <!> <div class="fx svelte-11c1mlk"></div> <div class="fx svelte-11c1mlk"></div> <img class="fx svelte-11c1mlk" alt="fx" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/> <img class="fx svelte-11c1mlk" alt="fx" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/> <img class="fx svelte-11c1mlk" alt="fx" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/> <img class="fx svelte-11c1mlk" alt="fx" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/> <img class="fx svelte-11c1mlk" alt="fx" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/></div> <!> <!> <!> <!></div>');function Jn(A,n){We(n,!0);let t=te(n,"context",15),s=te(n,"battleCtx",15),F=te(n,"overWorldCtx",15);const _=s().hazardsVersion;let d;const B=[];let D;const E={debug:!1,allydrawn:!1,opponentdrawn:!1,bgDrawn:!0},x=ke([]),b=ke([]),V=ke([!1,!1]),O=ke([!1,!1]);let N=!1,U=X(!1),ee=()=>{};const I=new Promise(r=>{ee=r});let T=X(!0),c=X(!1),q=X(!1),W=X(ke(s().battleField.weather)),j=X(ke(s().battleField.weatherTurns)),re=X(!1);const L=ke(["",""]),z=ke(["",""]),l={opponentHp:0,allyHp:200,actionButtons:400};Te(()=>{e(T)&&e(U)&&!e(re)&&(i(re,!0),window.setTimeout(async()=>{s().triggerInitialSwitchIn(),await s().processInitialAbilityActions(),i(T,!1)},300))}),Te(()=>{e(U)&&d?.querySelectorAll(".ally-shadow, .opponent-shadow")?.forEach(a=>{a.style.opacity="1"})}),Te(()=>{const r=[...V],a=[...O];r.forEach((f,h)=>{const S=d?.querySelector(`.ally-shadow[style*="--offSet: ${h}"]`);S&&(S.style.opacity=f?"0":e(U)?"1":"0")}),a.forEach((f,h)=>{const S=d?.querySelector(`.opponent-shadow[style*="--offSet: ${h}"]`);S&&(S.style.opacity=f?"0":e(U)?"1":"0")})});function k(r,a,f,h,S,$){const ae=s().getPokemonSide(h),me=s().getPokemonSide(S),Ce=ae==="ally"?s().playerSide.indexOf(h):s().oppSide.indexOf(h),Ie=me==="opponent"?s().oppSide.indexOf(S):s().playerSide.indexOf(S);return Ct({initiator:a,target:f,initiatorSlot:{side:ae==="ally"?"player":"opponent",index:Ce},targetSlot:{side:me==="opponent"?"opponent":"player",index:Ie},moveName:r.name,moveCategory:r.category,moveType:r.type,hitCount:$})}function G(r,a,f,h,S,$,ae){return Ct({initiator:a,target:f,initiatorSlot:{side:h==="ally"?"player":"opponent",index:S},targetSlot:{side:$,index:ae},moveName:r.name,moveCategory:r.category,moveType:r.type})}s().events.playerPokemonFaint.subscribe(r=>{if(r&&x){const a=s().playerSide.indexOf(r);setTimeout(()=>t().soundManager.playBattleSFX("faint"),2e3),kt(x[a]).then(()=>{V[a]=!0})}}),s().weatherVersion.subscribe(()=>{i(W,s().battleField.weather,!0),i(j,s().battleField.weatherTurns,!0)}),s().turnPhases.subscribe(r=>{r===Dt.UPKEEP&&s().battleField.weather!==Me.NONE&&(i(c,!0),window.setTimeout(()=>{i(c,!1)},600))}),s().events.weatherDamage.subscribe(r=>{r&&r!==Me.NONE&&(i(q,!0),window.setTimeout(()=>{i(c,!1)},1e3))}),s().events.statChangeAnimation.subscribe(async r=>{if(r){t().soundManager.playBattleSFX(r.stages>0?"stat-rise":"stat-fall");const a=Tn();if(a){const f=s().oppSide.includes(r.target),h=f?s().oppSide.indexOf(r.target):s().playerSide.indexOf(r.target),S=f?b[h]:x[h];if(S){const $={side:f?"opponent":"player",index:h},ae=r.stages>0?"buff":"debuff";await a.showSpriteEffect(ae,{element:S,slot:$,homePosition:a.getPosition($)},{scale:1.2,zIndex:a.getEffectZIndex($)})}}s().signalActionComplete(),s().events.statChangeAnimation.set(null)}}),s().events.weatherChange.subscribe(r=>{r&&(i(W,r.weather,!0),i(c,!0),window.setTimeout(()=>{i(c,!1)},600),s().signalActionComplete(),s().events.weatherChange.set(null))}),s().events.opponentPokemonFaint.subscribe(r=>{if(r&&b){const a=s().oppSide.indexOf(r);setTimeout(()=>t().soundManager.playBattleSFX("faint"),2e3),kt(b[a]).then(()=>{O[a]=!0})}}),s().events.runnaway.subscribe(r=>{r&&(N=!0,ct(x[0],"ally",0,d).then(()=>{ct(x[1],"ally",1,d)}))}),s().events.end.subscribe(r=>{if(r&&!N)for(let a=0;a<x.length;a++)x[a]&&!V[a]&&(t().soundManager.playBattleSFX("recall"),dt(x[a],"ally",a,d))});function M(r,a,f){if(r.power>0&&a!==f){const h=s().calculateTypeEffectiveness(r.type,a.types);h>1?t().soundManager.playBattleSFX("hit-super-effective"):h<1&&h>0?t().soundManager.playBattleSFX("hit-not-very-effective"):h>0&&t().soundManager.playBattleSFX("hit-normal")}}s().events.animateAttack.subscribe(r=>{if(r){const a=s().getPokemonSide(r.initiator)==="ally"?x[s().playerSide.indexOf(r.initiator)]:b[s().oppSide.indexOf(r.initiator)];let f;if(r.target===r.initiator?f=a:(f=s().getPokemonSide(r.target)==="opponent"?b[s().oppSide.indexOf(r.target)]:x[s().playerSide.indexOf(r.target)],f||(f=a)),r.move instanceof Et){const h=r.move,S=t().soundManager.playMoveSFXAsync(r.move.name);R(s().getPokemonSide(r.target)==="opponent"?"ally":"opponent",h.pokemon2).then($=>{st($,s().getPokemonSide(r.target)==="opponent"?"ally":"opponent",s().playerSide.length,!0,s().battleType===rt.DOUBLE).then(()=>{const ae=s().getPokemonSide(r.initiator),me=s().getPokemonSide(r.target)==="opponent"?"opponent":"player",Ce=ae==="ally"?s().playerSide.indexOf(r.initiator):s().oppSide.indexOf(r.initiator),Ie=me==="opponent"?s().oppSide.indexOf(r.target):s().playerSide.indexOf(r.target);G(h.move2,$,f,ae,s().playerSide.length,me,Ie),G(h.move1,a,f,ae,Ce,me,Ie).then(()=>{Promise.all([S]).then(()=>{M(r.move,r.target,r.initiator),s().signalActionComplete(),ct($,s().getPokemonSide(r.target)==="opponent"?"ally":"opponent",s().playerSide.length,d).then(()=>{$.remove()})})})})})}else{const h=k(r.move,a,f,r.initiator,r.target,r.hitCount),S=t().soundManager.playMoveSFXAsync(r.move.name);Promise.all([h,S]).then(()=>{M(r.move,r.target,r.initiator),s().signalActionComplete()})}}});function R(r,a){return new Promise((f,h)=>{const S=document.createElement("img");S.classList.add(r+"-partner-sprite"),r==="opponent"?S.src=a.getSprite():S.src=a.getSprite(!0),S.onload=()=>{const $=Math.max(Math.min(S.naturalHeight/200,.9),.1);return S.style.setProperty("--scale",$+""),S.style.setProperty("--width",S.naturalWidth+"px"),S.style.setProperty("--height",S.naturalHeight+"px"),d.appendChild(S),f(S)}})}function v(r){try{const a=document.createElement("canvas");a.width=r.naturalWidth,a.height=r.naturalHeight;const f=a.getContext("2d");if(!f)return 0;f.drawImage(r,0,0);const S=f.getImageData(0,0,a.width,a.height).data;for(let $=a.height-1;$>=0;$--)for(let ae=0;ae<a.width;ae++)if(S[($*a.width+ae)*4+3]>10)return(a.height-1-$)/a.height}catch{}return 0}function u(r,a,f){const h=r==="ally"?"ally-shadow":"opponent-shadow",S=d?.querySelector(`.${h}[data-idx="${a}"]`);if(!S)return;const $=r==="ally"?0:8,ae=f*50;S.style.bottom=`calc(${$+ae}% + var(--offSet) * 5%)`}function m(){D=window.setInterval(()=>{if(!E.opponentdrawn&&E.bgDrawn)if(b?.length!==s().oppSide.length)s().oppSide.forEach((r,a)=>{const f=document.createElement("img");f.addEventListener("click",()=>{}),f.classList.add("opponent-sprite"),f.style.setProperty("--offSet",`${a}`);const h=document.createElement("div");h.classList.add("opponent-shadow"),h.style.setProperty("--offSet",`${a}`),h.dataset.idx=`${a}`,d.appendChild(h),b[a]=f});else{const r=[];b.forEach((a,f)=>{const h=s()?.oppSide[f];h&&(a.src=h.getSprite(),a.onload=()=>{const S=a.naturalHeight,$=window.innerHeight,ae=Math.min(S/($*.15),.5);a.style.setProperty("--scale",ae+""),a.style.setProperty("--width",a.naturalWidth+"px"),a.style.setProperty("--height",a.naturalHeight+"px"),d.appendChild(a);const me=v(a);u("opponent",f,me);const Ce=st(a,"opponent",f,!1,s().battleType===rt.DOUBLE,s().isWild);r.push(Ce);const Ie=b.filter((Ye,Ue)=>s()?.oppSide[Ue]);r.length===Ie.length&&Promise.all(r).then(()=>{s().isWild&&s().oppSide.forEach(Ye=>{Ye&&t().soundManager.playCry(Ye.name)}),ee()})})}),E.opponentdrawn=!0}if(!E.allydrawn&&E.bgDrawn)if(x?.length!==s().playerSide.length)s().playerSide.forEach((r,a)=>{const f=document.createElement("img");f.addEventListener("click",()=>{}),f.classList.add("ally-sprite"),f.style.setProperty("--offSet",`${a}`);const h=document.createElement("div");h.classList.add("ally-shadow"),h.style.setProperty("--offSet",`${a}`),h.dataset.idx=`${a}`,d.appendChild(h),x[a]=f});else{const r=[];x.forEach((a,f)=>{const h=s()?.playerSide[f];h&&(a.src=h.getSprite(!0),a.onload=async()=>{const S=a.naturalHeight,$=window.innerHeight,ae=Math.min(S/($*.15),.5);a.style.setProperty("--scale",ae+""),a.style.setProperty("--width",a.naturalWidth+"px"),a.style.setProperty("--height",a.naturalHeight+"px"),await I,d.appendChild(a);const me=v(a);u("ally",f,me);const Ce=st(a,"ally",f,!1,s().battleType===rt.DOUBLE,!1);r.push(Ce),r.length===x.length&&Promise.all(r).then(()=>{s().playerSide.forEach(Ie=>{Ie&&t().soundManager.playCry(Ie.name)}),i(U,!0)})})}),E.allydrawn=!0}},200)}je(()=>{Mn(d),s().events.pokemonChange.subscribe(async a=>{if(a)if(a.side==="ally"?V[a.idx]:O[a.idx],t().soundManager.playBattleSFX("recall"),a?.side==="ally"){const f=s().playerSide[a?.idx];if(f&&x[a.idx]){await dt(x[a.idx],"ally",a.idx,d),V[a.idx]=!0;const h=f.getSprite(!0);x[a.idx].onload=()=>{V[a.idx]=!1,Se.set(x[a.idx],{x:0,y:0,filter:"brightness(1)",opacity:1,scale:1,transform:""}),st(x[a.idx],"ally",a.idx,!1,!1,!1).then(()=>{t().soundManager.playCry(f.name)});const S=v(x[a.idx]);u("ally",a.idx,S),L[a.idx]=f.name},x[a.idx].src="",x[a.idx].src=h}}else{const f=s().oppSide[a?.idx];if(f&&b[a.idx]){await dt(b[a.idx],"opponent",a.idx,d),O[a.idx]=!0;const h=f.getSprite();b[a.idx].onload=()=>{O[a.idx]=!1,Se.set(b[a.idx],{x:0,y:0,filter:"brightness(1)",opacity:1,scale:1,transform:""}),st(b[a.idx],"opponent",a.idx,!1,!1,!1).then(()=>{t().soundManager.playCry(f.name)});const S=v(b[a.idx]);u("opponent",a.idx,S),z[a.idx]=f.name},b[a.idx].src="",b[a.idx].src=h}}}),m();function r(a){a.key==="x"&&(E.debug=!E.debug)}return window.addEventListener("keydown",r),()=>{t().soundManager.stopAll(),zn(),clearInterval(D),window.removeEventListener("keydown",r)}});var w=Bn(),p=o(w),P=o(p),H=y(P,2);sn(H,{get weather(){return e(W)},get weatherTurns(){return e(j)},get flash(){return e(c)},get intensify(){return e(q)}});var K=y(H,2);An(K,{get allySide(){return s().battleField.allySide},get enemySide(){return s().battleField.enemySide},get hazardsVersion(){return _}});var oe=y(K,2);Pn(oe,{get allySide(){return s().battleField.allySide},get enemySide(){return s().battleField.enemySide}});var Q=y(oe,6);Le(Q,r=>B[0]=r,()=>B?.[0]);var se=y(Q,2);Le(se,r=>B[1]=r,()=>B?.[1]);var fe=y(se,2);Le(fe,r=>B[2]=r,()=>B?.[2]);var pe=y(fe,2);Le(pe,r=>B[3]=r,()=>B?.[3]);var ie=y(pe,2);Le(ie,r=>B[4]=r,()=>B?.[4]),Le(p,r=>d=r,()=>d);var he=y(p,2);{var Ee=r=>{var a=Ae(),f=ue(a);$e(f,()=>z[0],h=>{{let S=Y(()=>e(T)?l.opponentHp:0),$=Y(()=>!O[0]);ot(h,{get pokemon(){return s().oppSide[0]},position:{bottom:"66%",left:"62%"},isAlly:!1,get spriteElement(){return b[0]},get entranceDelay(){return e(S)},get visible(){return e($)},side:"opponent",index:0})}}),g(r,a)};J(he,r=>{s().oppSide[0]&&e(U)&&r(Ee)})}var Pe=y(he,2);{var Je=r=>{var a=Ae(),f=ue(a);$e(f,()=>L[0],h=>{{let S=Y(()=>e(T)?l.allyHp:0),$=Y(()=>!V[0]);ot(h,{get pokemon(){return s().playerSide[0]},position:{bottom:"50%",left:"22%"},isAlly:!0,get spriteElement(){return x[0]},get entranceDelay(){return e(S)},get visible(){return e($)},side:"ally",index:0})}}),g(r,a)};J(Pe,r=>{s().playerSide[0]&&e(U)&&r(Je)})}var Ve=y(Pe,2);{var Ge=r=>{var a=Hn(),f=ue(a);{var h=ae=>{var me=Ae(),Ce=ue(me);$e(Ce,()=>z[1],Ie=>{{let Ye=Y(()=>e(T)?l.opponentHp:0),Ue=Y(()=>!O[1]);ot(Ie,{get pokemon(){return s().oppSide[1]},position:{bottom:"70%",left:"58%"},isAlly:!1,get spriteElement(){return b[1]},get entranceDelay(){return e(Ye)},get visible(){return e(Ue)},side:"opponent",index:1})}}),g(ae,me)};J(f,ae=>{s().oppSide[1]&&e(U)&&ae(h)})}var S=y(f,2);{var $=ae=>{var me=Ae(),Ce=ue(me);$e(Ce,()=>L[1],Ie=>{{let Ye=Y(()=>e(T)?l.allyHp:0),Ue=Y(()=>!V[1]);ot(Ie,{get pokemon(){return s().playerSide[1]},position:{bottom:"56%",left:"8%"},isAlly:!0,get spriteElement(){return x[1]},get entranceDelay(){return e(Ye)},get visible(){return e(Ue)},side:"ally",index:1})}}),g(ae,me)};J(S,ae=>{s().playerSide[1]&&e(U)&&ae($)})}g(r,a)};J(Ve,r=>{s().battleType===rt.DOUBLE&&r(Ge)})}var Re=y(Ve,2);{let r=Y(()=>e(T)&&e(U)?l.actionButtons:0);Fa(Re,{get allySprites(){return x},get entranceDelay(){return e(r)},get isInitialEntrance(){return e(T)},get visible(){return e(U)},get context(){return t()},set context(a){t(a)},get battleCtx(){return s()},set battleCtx(a){s(a)},get overWorldCtx(){return F()},set overWorldCtx(a){F(a)}})}Z(()=>ve(P,`background-image: url(${Ln})`)),g(A,w),Fe()}export{Jn as default};
